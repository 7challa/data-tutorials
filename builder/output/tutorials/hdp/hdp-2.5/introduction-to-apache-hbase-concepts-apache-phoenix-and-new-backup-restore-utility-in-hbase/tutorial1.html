<div class="tutorial-content">
  <h1 id="introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup--restore-utility-in-hbase">Introduction to Apache HBase Concepts, Apache Phoenix and New Backup &amp; Restore Utility in HBase</h1>

<h2 id="lab-1-introducing-apache-hbase-concepts">Lab 1: Introducing Apache HBase Concepts</h2>

<h2 id="introduction">Introduction</h2>

<p>HBase is a distributed column-oriented database built on top of the Hadoop file system. It is an open-source project and is horizontally scalable. HBase is a data model that is similar to Google’s big table designed to provide quick random access to huge amounts of unstructured data. It leverages the fault tolerance provided by the Hadoop File System (HDFS).</p>

<p>The components of HBase data model consist of tables, rows, column families, columns, cells and versions. Tables are like logical collection of rows stored in separate partitions. A row is one instance of data in a table and is identified by a  rowkey. Data in a row are grouped together as Column Families. Each Column Family has one or more Columns and these Columns in a family are stored together. Column Families form the basic unit of physical storage, hence it’s important that proper care be taken when designing Column Families in table. A Column is identified by a Column Qualifier that consists of the Column Family name concatenated with the Column name using a colon. A Cell stores data and is essentially a unique combination of rowkey, Column Family and the Column (Column Qualifier). The data stored in a cell is versioned and versions of data are identified by the timestamp.</p>

<p>For more information, refer HBase documentation <a href="https://hortonworks.com/apache/hbase/">here</a>.</p>

<p>In this tutorial, we are going to walk you through some basic HBase shell commands, how to use Apache Phoenix which enables OLTP and operational analytics in Hadoop by combining the power of standard SQL and JDBC APIs and the flexibility of late-bound, schema-on-read capabilities from the NoSQL world by leveraging HBase as its backing store.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="https://hortonworks.com/downloads/#sandbox">Download Hortonworks 2.5 Sandbox</a></li>
  <li>Complete the <a href="https://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/">Learning the Ropes of the Hortonworks Sandbox tutorial,</a> you will need it for logging into Ambari as an administrator user.</li>
</ul>

<h2 id="outline">Outline</h2>

<ul>
  <li><a href="#start-hbase">1. Start HBase</a>
    <ul>
      <li><a href="#view-hbase-service">1.1 View the HBase Services page</a></li>
      <li><a href="#start-hbase-service">1.2 Start HBase Service</a></li>
    </ul>
  </li>
  <li><a href="#enter-hbase-shell">2. Enter HBase Shell</a></li>
  <li><a href="#ddl-hbase">3. Data Definition Language Commands in HBase</a>
    <ul>
      <li><a href="#create">3.1 Create</a></li>
      <li><a href="#list">3.2 List</a></li>
    </ul>
  </li>
  <li><a href="#dml-hbase">4. Data Manipulation Commands in HBase</a>
    <ul>
      <li><a href="#scan">4.1 Scan</a></li>
      <li><a href="#put">4.2 Put</a></li>
      <li><a href="#get">4.3 Get</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#appendix">Appendix</a></li>
</ul>

<h2 id="1-start-hbase-">1. Start HBase <a id="start-hbase"></a></h2>

<h3 id="11-view-the-hbase-services-page-">1.1 View the HBase Services page <a id="view-hbase-service"></a></h3>

<p>In order to start/stop HBase service, you must log into Ambari as an administrator. The default account (maria_dev) will not allow you to do this. Please follow these step to setup password for admin account.
First SSH into the Hortonworks Sandbox with the command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;ssh root@127.0.0.1 -p 2222
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/sshTerminal.png" alt="sshTerminal" /></p>

<p>If do do not have ssh client, you can also access the shell via <code class="highlighter-rouge">http://localhost:4200/</code>
Now run the following command to reset the password for user <code class="highlighter-rouge">admin</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;ambari-admin-password-reset
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/admin_password_reset.png" alt="admin_password_reset" /></p>

<p>Now navigate to Ambari on 127.0.0.1:8080 on the browser and give your credentials</p>

<p>From the Dashboard page of Ambari, click on <code class="highlighter-rouge">HBase</code> from the list of installed services.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/hbase_service_on_off_iot.png" alt="hbaseServiceOnOff" /></p>

<h3 id="12-start-hbase-service-">1.2 Start HBase Service <a id="start-hbase-service"></a></h3>

<p>From the HBase page, click on Service Actions -&gt; <code class="highlighter-rouge">Start</code></p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/start_hbase_service_iot.png" alt="starthbaseService" /></p>

<p>Check the box and click on Confirm Start:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/confirm_hbase_start_iot.png" alt="confirmhbaseStartIot" /></p>

<p>Check the box to turn off the Maintenance Mode as it suppresses alerts, warnings and status change indicators generated for the object.
Wait for HBase to start (It may take a few minutes to turn green)</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/hbase_started_iot.png" alt="hbaseStartedIot" /></p>

<h2 id="2-enter-hbase-shell-">2. Enter HBase Shell <a id="enter-hbase_shell"></a></h2>

<p>HBase comes with an interactive shell from where you can communicate with HBase components and perform operations on them.</p>

<p>First SSH into the Hortonworks Sandbox with the command:</p>

<p>Switch the user to hbase.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;su hbase
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/switch_to_hbase.png" alt="switchTohbase" /></p>

<p>Type <code class="highlighter-rouge">hbase shell</code> and you will see the following screen:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/enter_HBase_shell.png" alt="enterhbaseShell" /></p>

<p>To exit the interactive shell, type <code class="highlighter-rouge">exit</code> or use <code class="highlighter-rouge">&lt;ctrl+c&gt;</code>. But wait, it is time to explore more features of the shell.</p>

<h2 id="3-data-definition-language-commands-in-hbase-">3. Data Definition Language Commands in HBase <a id="ddl-hbase"></a></h2>

<p>These are the commands that operate on tables in HBase.</p>

<h3 id="31-create-">3.1 Create <a id="create"></a></h3>

<p>The syntax to create a table in HBase is <code class="highlighter-rouge">create '&lt;table_name&gt;','&lt;column_family_name&gt;'</code>. Let’s create a table called ‘<strong>driver_dangerous_event’</strong> with a column family of name <strong>events</strong>. Run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt; create 'driver_dangerous_event','events'
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/create_table.png" alt="create_table" /></p>

<h3 id="32-list-">3.2 List <a id="list"></a></h3>

<p>Let’s check the table we’ve just created, type the following command in the HBase shell</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt; list
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/list_table.png" alt="list_table" /></p>

<h2 id="4-data-manipulation-commands-in-hbase-">4. Data Manipulation Commands in HBase <a id="dml-hbase"></a></h2>

<p>Let’s import some data into the table. We’ll use a sample dataset that tracks driving record of a logistics company.</p>

<p>Open a new terminal and ssh into the Sandbox. Download the data.csv file and let’s copy the file in HDFS,</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;ssh root@127.0.0.1 -p 2222

$&gt;curl -o ~/data.csv https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/data.csv

$&gt;hadoop fs -copyFromLocal ~/data.csv /tmp
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/copyFromLocal_data_csv.png" alt="copyFromLocal_data_csv" /></p>

<p>Now execute the <code class="highlighter-rouge">LoadTsv</code> from hbase user statement as following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;su hbase

$&gt;hbase org.apache.hadoop.hbase.mapreduce.ImportTsv -Dimporttsv.separator=,  -Dimporttsv.columns="HBASE_ROW_KEY,events:driverId,events:driverName,events:eventTime,events:eventType,events:latitudeColumn,events:longitudeColumn,events:routeId,events:routeName,events:truckId" driver_dangerous_event hdfs://sandbox.hortonworks.com:/tmp/data.csv
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/importtsv_command.png" alt="importtsv_command" /></p>

<p>Now let’s check whether the data got imported in the table <code class="highlighter-rouge">driver_dangerous_events</code> or not. Go back to the <code class="highlighter-rouge">hbase shell</code>.</p>

<h3 id="41-scan-">4.1 Scan <a id="scan"></a></h3>

<p>The scan command is used to view the data in the HBase table. Type the following command:
<code class="highlighter-rouge">scan 'driver_dangerous_event'</code></p>

<p>You will see all the data present in the table with row keys and the different values for different columns in a column family.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/scan_command.png" alt="scan_command" /></p>

<h3 id="42-put-">4.2 Put <a id="put"></a></h3>

<p>Using put command, you can insert rows in a HBase table. The syntax of put command is as follows:
<code class="highlighter-rouge">put '&lt;table_name&gt;','row1','&lt;column_family:column_name&gt;','value'</code></p>

<p>Copy following lines to put the data in the table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>put 'driver_dangerous_event','4','events:driverId','78'
put 'driver_dangerous_event','4','events:driverName','Carl'
put 'driver_dangerous_event','4','events:eventTime','2016-09-23 03:25:03.567'
put 'driver_dangerous_event','4','events:eventType','Normal'
put 'driver_dangerous_event','4','events:latitudeColumn','37.484938'
put 'driver_dangerous_event','4','events:longitudeColumn','-119.966284'
put 'driver_dangerous_event','4','events:routeId','845'
put 'driver_dangerous_event','4','events:routeName','Santa Clara to San Diego'
put 'driver_dangerous_event','4','events:truckId','637'
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/put_command.png" alt="put_command" /></p>

<p>Now let’s view a data from scan command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt;scan 'driver_dangerous_event'
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/scan_command1.png" alt="scan_command1" /></p>

<p>You can also update an existing cell value using the <code class="highlighter-rouge">put</code> command. The syntax for replacing is same as inserting a new value.</p>

<p>So let’s update a route name value of row key 4, from <code class="highlighter-rouge">'Santa Clara to San Diego'</code> to <code class="highlighter-rouge">'Santa Clara to Los Angeles'</code>. Type the following command in HBase shell:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt;put 'driver_dangerous_event','4','events:routeName','Santa Clara to Los Angeles'
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/update_table.png" alt="update_table" /></p>

<p>Now scan the table to see the updated data:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt;scan 'driver_dangerous_event'
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/scan_command2.png" alt="scan_command2" /></p>

<h3 id="43-get-">4.3 Get <a id="get"></a></h3>

<p>It is used to read the data from HBase table. It gives a single row of data at a time. Syntax for get command is:
<code class="highlighter-rouge">get '&lt;table_name&gt;','&lt;row_number&gt;'</code></p>

<p>Try typing <code class="highlighter-rouge">get 'driver_dangerous_event','1'</code> in the shell. You will see the all the column families (in our case, there is only 1 column family) along with all the columns in the row.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/get_command.png" alt="get_command" /></p>

<p>You can also read a specific column from get command. The syntax is as follows:
<code class="highlighter-rouge">get 'table_name', 'row_number', {COLUMN ⇒ 'column_family:column-name '}</code></p>

<p>Type the following statement to get the details from the row 1 and the driverName of column family events.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt;get 'driver_dangerous_event','1',{COLUMN =&gt; 'events:driverName'}
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/get_command_column.png" alt="get_command_column" /></p>

<p>If you want to view the data from two columns, just add it to the {COLUMN =&gt;…} section. Run the following command to get the details from row key 1 and the driverName and routeId of column family events:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase&gt;get 'driver_dangerous_event','1',{COLUMNS =&gt; ['events:driverName','events:routeId']}
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdp/hdp-2.5/introduction-to-apache-hbase-concepts-apache-phoenix-and-new-backup-restore-utility-in-hbase/assets/get_command_two_columns.png" alt="get_command_two_columns" /></p>

<h2 id="summary-">Summary <a id="summary"></a></h2>

<p>In this tutorial, we learned about the basic concepts of Apache HBase and different types of data definition and data manipulation commands that are available in HBase shell. Check out the lab 2 of this tutorial where we are going to learn how to use Apache Phoenix with Apache HBase.</p>

<h2 id="appendix-">Appendix <a id="appendix"></a></h2>

<p><strong>ImportTsv Utility in HBase:</strong></p>

<p>ImportTsv is a utility that will load data in TSV or CSV format into a specified HBase table. The column names of the TSV data must be specified using the -Dimporttsv.columns option. This option takes the form of comma-separated column names, where each column name is either a simple column family, or a columnfamily:qualifier. The special column name HBASE_ROW_KEY is used to designate that this column should be used as the row key for each imported record. You must specify exactly one column to be the row key, and you must specify a column name for every column that exists in the input data. In our case, events is a column family and driverId, driverName,etc are columns.</p>

<p>Next argument is the table name where you want the data to be imported
Third argument specifies the input directory of CSV data.</p>

</div>

<hr>

<div id="tutorial-footer">
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>

  <p>If you need help or have questions with this tutorial, please check HCC for answers to existing questions about this tutorial by using the Find Answers button below.  You can post a new HCC question by using the Ask Questions button below.</p>

  <p>
    <a class="btn" href="https://community.hortonworks.com/topics/tutorial-650.html" role="button">Find Answers</a>
    <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-650&amp;topics=hdp-2.5.0" role="button">Ask Questions</a>
  </p>

  <p>Tutorial Name: <strong>Introduction to Apache HBase Concepts, Apache Phoenix and New Backup & Restore Utility in HBase</strong></p>
  <p>HCC Tags:<strong> tutorial-650</strong> and <strong>hdp-2.5.0</strong></p>
  <p>If the tutorial has multiple components please indicate which one your question relates to.</p>

  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks GitHub repository and can be contributed to by following the <a href="https://github.com/hortonworks/big-data-tutorials/wiki">Tutorial Contribution Guide</a>.  For issues/bugs/feedback, please <a href="https://github.com/hortonworks/big-data-tutorials/issues/new">submit an issue</a> and we will do our best to resolve it!</p>
</div>

