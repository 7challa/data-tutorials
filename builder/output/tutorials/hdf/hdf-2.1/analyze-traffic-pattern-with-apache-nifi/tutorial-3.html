<div class="tutorial-content">
  <h1 id="tutorial-1-build-a-simple-nifi-dataflow">Tutorial 1: Build A Simple NiFi DataFlow</h1>

<h2 id="introduction">Introduction</h2>

<p>In this tutorial, we will build a NiFi DataFlow to fetch vehicle location, speed, and other sensor data from a San Francisco Muni traffic simulator, look for observations of a specific few vehicles, and store the selected observations into a new file. Even though this aspect of the tutorial is not streaming data, you will see the importance of file I/O in NiFi dataflow application development and how it can be used to simulate streaming data.</p>

<p>In this tutorial, you will build the following dataflow:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/completed-data-flow-lab1.png" alt="completed-data-flow-lab1" /></p>

<p><strong>Figure 1:</strong> The completed dataflow contains three sections: ingest data from vehicle location XML Simulator, extract vehicle location detail attributes from FlowFiles and route these detail attributes to a JSON file as long as they are not empty strings. You will learn more in depth about each processors particular responsibility in each section of the dataflow.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Completed Learning the Ropes of Apache NiFi</li>
  <li>Completed Tutorial 0: Download, Install and Start NiFi</li>
</ul>

<h2 id="outline">Outline</h2>
<ul>
  <li><a href="#approach1">Approach 1</a></li>
  <li><a href="#approach2">Approach 2</a></li>
  <li><a href="#create-nifi-dataflow">Step 2.1: Create a NiFi DataFlow</a></li>
  <li><a href="#build-xml-simulator-flow">Step 2.2: Build XML Simulator DataFlow Section</a></li>
  <li><a href="#build-key-attributes-extraction">Step 2.3: Build Key Attribute Extraction DataFlow Section</a></li>
  <li><a href="#build-filter-json-conversion">Step 2.4: Build Filter and JSON Conversion DataFlow Section</a></li>
  <li><a href="#run-nifi-dataflow-tutorial1">Step 2.5: Run the NiFi DataFlow</a></li>
  <li><a href="#summary-tutorial1">Summary</a></li>
  <li><a href="#further-reading-tutorial1">Further Reading</a></li>
  <li><a href="#appendix-a-review-dataflow">Appendix A: Review of NiFi DataFlow</a></li>
  <li><a href="#appendix-b-create-labels">Appendix B: Create Labels for Processor Groups</a></li>
</ul>

<h2 id="approach-1-">Approach 1 <a id="approach1"></a></h2>

<p>Feel free to download the <a href="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/learning-ropes-nifi-lab-series/lab1-template/Lab1-NiFi-Learn-Ropes.xml">Lab1-NiFi-Learn-Ropes.xml</a> template file or if you prefer to build the dataflow from scratch, continue on to <strong>Step 1</strong>.</p>

<p>1. Click on the template icon <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/nifi_template_icon.png" alt="nifi_template_icon" /> located in the actions toolbar.</p>

<p>2. Click <strong>Browse</strong>, find the template file, click <strong>Open</strong> and hit <strong>Import</strong>.</p>

<p>3. Hover over to the top left of the NiFi HTML interface, drag the template icon <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/add_nifi_template.png" alt="nifi_template_icon" /> onto the graph and select the <strong>NiFi-DataFlow-Lab1.xml</strong> template file.</p>

<p>4.  Download <a href="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/trafficLocs_data_for_simulator.zip">trafficLocs_data_for_simulator.zip</a> which is our input data.</p>

<p>If <strong>NiFi is on Sandbox</strong>, SSH into the shell:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ssh root@sandbox.hortonworks.com -p 2222
</code></pre>
</div>

<p>Let’s create a new <code class="highlighter-rouge">/tmp/nifi/input</code> directory, modify permissions for nifi directory that way NiFi can write to output, then send the zip file to the sandbox with the command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir -p /tmp/nifi/input
chmod -R 777 /tmp/nifi
exit
scp -P 2222 ~/Downloads/trafficLocs_data_for_simulator.zip root@sandbox.hortonworks.com:/tmp/nifi/input
</code></pre>
</div>

<p>If <strong>NiFi is on local machine</strong>, create a new folder named <code class="highlighter-rouge">/tmp/nifi/input</code> in the <code class="highlighter-rouge">/</code> directory, modify permissions and then copy the input dataset to this new folder:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir -p /tmp/nifi/input
chmod -R 777 /tmp/nifi
cp ~/Downloads/trafficLocs_data_for_simulator.zip /tmp/nifi/input
</code></pre>
</div>

<p>5. Hit the <strong>start</strong> button <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/start_button_nifi_iot.png" alt="start_button_nifi_iot" />. to activate the dataflow. We highly recommend you read through the lab, so you become familiar with the process of building a dataflow.</p>

<h2 id="approach-2-">Approach 2 <a id="approach2"></a></h2>

<h3 id="step-21-create-a-nifi-dataflow-">Step 2.1: Create a NiFi DataFlow <a id="create-nifi-dataflow"></a></h3>

<p>The building blocks of every dataflow consist of processors. These tools perform actions on data to ingest, route, extract, split, aggregate or store it. Our dataflow will contain these processors, each processor includes a high level description of their role in the tutorial:</p>

<ul>
  <li><strong>GetFile</strong> reads vehicle location data from traffic stream zip file</li>
  <li><strong>UnpackContent</strong> decompresses the zip file</li>
  <li><strong>ControlRate</strong> controls the rate at which FlowFiles move to the flow</li>
  <li><strong>EvaluateXPath(x2)</strong> extracts nodes (elements, attributes, etc.) from the XML file</li>
  <li><strong>SplitXml</strong> splits the XML file into separate FlowFiles, each comprised of children of the parent element</li>
  <li><strong>UpdateAttribute</strong> assigns each FlowFile a unique name</li>
  <li><strong>RouteOnAttribute</strong> makes the filtering decisions on the vehicle location data</li>
  <li><strong>AttributesToJSON</strong> represents the filtered attributes in JSON format</li>
  <li><strong>MergeContent</strong> merges the FlowFiles into one FlowFile by concatenating their JSON content together</li>
  <li><strong>PutFile</strong> writes filtered vehicle location data content to a directory on the local file system</li>
</ul>

<p>Refer to <a href="https://nifi.apache.org/docs.html">NiFi’s Documentation</a> to learn more about each processor described above.</p>

<h3 id="211-learning-objectives-overview-of-dataflow-build-process">2.1.1 Learning Objectives: Overview of DataFlow Build Process</h3>
<ul>
  <li>Build a NiFi DataFlow to ingest, filter, convert and store moving data</li>
  <li>Establish connections and relationships between processors</li>
  <li>Troubleshoot problems that may occur</li>
  <li>Run the the NiFi DataFlow</li>
</ul>

<p>Your dataflow will extract the following XML Attributes from the transit data listed in Table 1. We will learn how to do this extraction with the EvaluateXPath processor when we build our dataflow.</p>

<p><strong>Table 1: Extracted XML Attributes From Transit Data</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Attribute Name</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: right">Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">id</td>
      <td style="text-align: center">string</td>
      <td style="text-align: right">Vehicle ID</td>
    </tr>
    <tr>
      <td style="text-align: left">time</td>
      <td style="text-align: center">int64</td>
      <td style="text-align: right">Observation timestamp</td>
    </tr>
    <tr>
      <td style="text-align: left">lat</td>
      <td style="text-align: center">float64</td>
      <td style="text-align: right">Latitude (degrees)</td>
    </tr>
    <tr>
      <td style="text-align: left">lon</td>
      <td style="text-align: center">float64</td>
      <td style="text-align: right">Longitude (degrees)</td>
    </tr>
    <tr>
      <td style="text-align: left">speedKmHr</td>
      <td style="text-align: center">float64</td>
      <td style="text-align: right">Vehicle speed (km/h)</td>
    </tr>
    <tr>
      <td style="text-align: left">dirTag</td>
      <td style="text-align: center">float64</td>
      <td style="text-align: right">Direction of travel</td>
    </tr>
  </tbody>
</table>

<p>After extracting, filtering and converting the data, your new file, which contains transit location data will be stored in the Output Directory listed in Table 2. We will learn how to satisfy the conditions in Table 2 with RouteOnAttribute, AttributesToJSON and PutFile processors.</p>

<p><strong>Table 2: Other DataFlow Requirements</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parameter</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Input Directory</td>
      <td style="text-align: right">/tmp/nifi/input</td>
    </tr>
    <tr>
      <td style="text-align: left">Output Directory</td>
      <td style="text-align: right">/tmp/nifi/output/filtered_transitLoc_data</td>
    </tr>
    <tr>
      <td style="text-align: left">File Format</td>
      <td style="text-align: right">JSON</td>
    </tr>
    <tr>
      <td style="text-align: left">Filter For</td>
      <td style="text-align: right">id, time, lat, lon, speedKmHr, dirTag</td>
    </tr>
  </tbody>
</table>

<p>Let’s build our dataflow to fetch, filter, convert and store transit sensor data from San Francisco Muni, M-Ocean View route. Here is a visualization, courtesy of NextBus and Google, of the data NiFi generates using our Traffic XML Simulator:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/live_stream_sf_muni_nifi_learning_ropes.png" alt="sf_ocean_view_route_nifi_streaming" /></p>

<h3 id="212-add-processors">2.1.2 Add processors</h3>

<p>1. Go to the <strong>components</strong> toolbar, drag and drop the processor icon <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/processor_nifi_iot.png" alt="processor_nifi_iot" /> onto the graph.</p>

<p>An <strong>Add Processor</strong> window will appear with 3 ways to find our desired processor: <strong>processor list</strong>, <strong>tag cloud</strong>, or <strong>filter bar</strong></p>

<ul>
  <li>processor list: contains almost 180 processors</li>
  <li>tag cloud: reduces list by category</li>
  <li>filter bar: search for desired processor</li>
</ul>

<p>2. Select the <strong>GetFile</strong> processor and a short description of the processor’s function will appear.</p>

<p>Creates FlowFiles from files in a directory. NiFI will ignore files it doesn’t have at least read permissions for.</p>

<!---
- **GetFile** fetches the vehicle location simulator data for files in a directory.
--->

<p>Click the <strong>Add</strong> button to add the processor to the graph.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/add_processor_getfile_nifi-learn-ropes.png" alt="add_processor_getfile_nifi-learn-ropes" /></p>

<p>3. Add the <strong>UnpackContent, ControlRate, EvaluateXPath, SplitXML, UpdateAttribute, EvaluateXPath, RouteOnAttribute, AttributesToJSON, MergeContent</strong> and <strong>PutFile</strong> processors using the processor icon.</p>

<p>Overview of Each Processor’s Role in our DataFlow:</p>

<ul>
  <li><strong>GetFile</strong> fetches the vehicle location simulator data for files in a directory.</li>
  <li><strong>UnpackContent</strong> decompresses the contents of FlowFiles from the traffic simulator zip file.</li>
  <li><strong>ControlRate</strong> controls the rate at which FlowFiles are transferred to follow-on processors enabling traffic simulation.</li>
  <li><strong>EvaluateXPath</strong> extracts the timestamp of the last update for vehicle location data returned from each FlowFile.</li>
  <li><strong>SplitXML</strong> splits the parent’s child elements into separate FlowFiles. Since vehicle is a child element in our xml file, each new vehicle element is stored separately.</li>
  <li><strong>EvaluateXPath</strong> extracts attributes: vehicle id, direction latitude, longitude and speed from vehicle element in each FlowFile.</li>
  <li><strong>RouteOnAttribute</strong> transfers FlowFiles to follow-on processors only if vehicle ID, speed, latitude, longitude, timestamp and direction match the filter conditions.</li>
  <li><strong>AttributesToJSON</strong> generates a JSON representation of the attributes extracted from the FlowFiles and converts XML to JSON format this less attributes.</li>
  <li><strong>MergeContent</strong> merges a group of JSON FlowFiles together based on a number of FlowFiles and packages them into a single FlowFile.</li>
  <li><strong>UpdateAttribute</strong> updates the attribute name for each FlowFile.</li>
  <li><strong>PutFile</strong> writes the contents of the FlowFile to a desired directory on the local filesystem.</li>
</ul>

<p>Follow the step above to add these processors. You should obtain the image below:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/added_processors_nifi_part1.png" alt="added_processors_nifi_part1" /></p>

<blockquote>
  <p>Note: To find more information on the processor, right click ExecuteProcess and click <strong>usage</strong>. An in app window will appear with that processor’s documentation. Also if you want to create color coded labels that act as a background for a processor group, refer to <strong>Appendix B</strong> at the bottom of the page.</p>
</blockquote>

<h3 id="213-troubleshoot-common-processor-issues">2.1.3 Troubleshoot Common Processor Issues</h3>

<p>Notice the eleven processors in the image above have warning symbols <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/warning_symbol_nifi_iot.png" alt="warning_symbol_nifi_iot" /> in the upper left corner of the processor face. These warning symbols indicate the processors are invalid.</p>

<p>1. To troubleshoot, hover over one of the processors, for instance the <strong>GetFile</strong> processor, and a warning symbol will appear. This message informs us of the requirements needed, so we can run this processor.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/warning_getFile_processor_nifi_lab1.png" alt="error_getFile_processor_nifi_lab1" /></p>

<p>The warning message indicates: we need to specify a directory path to tell the processor where to pull data and a connection for the processor to establish a relationship.
Each Processor will have its own alert message. Let’s configure and connect each processor to remove all the warning messages, so we can have a live data flow.</p>

<h3 id="214-configure--connect-processors">2.1.4 Configure &amp; Connect processors</h3>

<p>Now that we added some processors, we will configure our processors in the <strong>Configure Processor</strong> window, which contains 4 tabs: <strong>Settings</strong>, <strong>Scheduling</strong>, <strong>Properties</strong> and <strong>Comments</strong>. We will spend most of our time in the properties tab since it is the main place to configure specific information that the processor needs to run properly. The properties that are in bold are required for the processor to be valid. If you want more information on a particular property, hover over the help icon <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/question_mark_symbol_properties_config_iot.png" alt="question_mark_symbol_properties_config_iot.png" /> located next to the Property Name with the mouse to read a description of the property. While we configure each processor, we will also connect each processor together and establish a relationship for them to make the dataflow complete.</p>

<p>If you would like to read more about configuring and connecting processors, refer to <a href="http://docs.hortonworks.com/HDPDocuments/HDF1/HDF-1.2.0.1/bk_UserGuide/content/ch_UserGuide.html">Hortonworks Apache NiFi User Guide</a>, Building a DataFlow: section 6.2 and 6.5.</p>

<h3 id="step-22-build-xml-simulator-dataflow-section-">Step 2.2: Build XML Simulator DataFlow Section <a id="build-xml-simulator-flow"></a></h3>

<h3 id="221-getfile">2.2.1 GetFile</h3>

<p>1. If you have not yet downloaded the input data set, click here <a href="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/trafficLocs_data_for_simulator.zip">trafficLocs_data_for_simulator.zip</a>.</p>

<h3 id="nifi-on-sandbox-option-1">NiFi on Sandbox (Option 1)</h3>

<p>If <strong>NiFi is on Sandbox</strong>, SSH into the shell. Else move to the next section:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ssh root@sandbox.hortonworks.com -p 2222
</code></pre>
</div>

<p>Let’s create a new <code class="highlighter-rouge">/tmp/nifi/input</code> directory, modify permissions for nifi directory that way NiFi can write to output, then send the zip file to the sandbox with the command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mkdir -p /tmp/nifi/input
chmod -R 777 /tmp/nifi
<span class="nb">exit
</span>scp -P 2222 ~/Downloads/trafficLocs_data_for_simulator.zip root@sandbox.hortonworks.com:/tmp/nifi/input
</code></pre>
</div>

<h3 id="nifi-on-local-machine-option-2">NiFi on Local Machine (Option 2)</h3>

<p>If <strong>NiFi is on local machine</strong>, create a new folder named <code class="highlighter-rouge">/tmp/nifi/input</code> in the <code class="highlighter-rouge">/</code> directory with the command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mkdir -p /tmp/nifi/input
chmod -R 777 /tmp/nifi
cp ~/Downloads/trafficLocs_data_for_simulator.zip /tmp/nifi/input
</code></pre>
</div>

<p>Right click on the <strong>GetFile</strong> processor and click <strong>configure</strong> from dropdown menu</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/configure_processor_nifi_iot.png" alt="configure_processor_nifi_iot" /></p>

<p>2. Click on the <strong>Properties</strong> tab. Add the properties listed in Table 3 to the processor’s appropriate properties and if their original properties already have values, update them. Click the <strong>OK</strong> button after changing a property.</p>

<p><strong>Table 3:</strong> Update GetFile Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Input Directory</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">/tmp/nifi/input</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Keep Source File</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">true</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><strong>Input Directory</strong> location at which data is ingested into the dataflow</p>
  </li>
  <li>
    <p><strong>Keep Source File</strong> source files in directory remain after all data is ingested</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/getFile_config_property_tab_window.png" alt="getFile_config_property_tab_window" /></p>

<p><strong>Figure 3:</strong> GetFile Configuration Property Tab Window</p>

<p>3. Now that each property is updated. Navigate to the <strong>Scheduling tab</strong> and change the <strong>Run Schedule</strong> from 0 sec to <code class="highlighter-rouge">1 sec</code>, so that the processor executes a task every 1 second. Therefore, overuse of system resources is prevented.</p>

<p>4. Now that each required item is updated, click <strong>Apply</strong>. Connect <strong>GetFile</strong> to <strong>UnpackContent</strong> processor by dragging the arrow icon from the first processor to the next component. When the Create Connection window appears, verify <strong>success</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="222-unpackcontent">2.2.2 UnpackContent</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 4 and if their original properties already have values, update them.</p>

<p><strong>Table 4:</strong> Update UnpackContent Property Value</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Packaging Format</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">zip</code></td>
    </tr>
  </tbody>
</table>

<p><strong>Packaging Format</strong> tells the processor of packaging format used to create the file</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/unpackContent_config_property_tab_window.png" alt="unpackContent_config_property_tab_window" /></p>

<p><strong>Figure 4:</strong> UnpackContent Configuration Property Tab Window</p>

<p>2. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>original</strong> checkboxes. Click <strong>Apply</strong>.</p>

<p>3. Connect <strong>UnpackContent</strong> to <strong>ControlRate</strong> processor. When the Create Connection window appears, verify <strong>success</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="223-controlrate">2.2.3 ControlRate</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 5 and if their original properties already have values, update them.</p>

<p><strong>Table 5:</strong> Update ControlRate Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Rate Control Criteria</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">flowfile count</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Maximum Rate</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">1</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Time Duration</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">6 second</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><strong>Rate Control Criteria</strong> instructs the processor to count the number of FlowFile before a transfer takes place</p>
  </li>
  <li>
    <p><strong>Maximum Rate</strong> instructs the processor to transfer 1 FlowFile at a time</p>
  </li>
  <li>
    <p><strong>Time Duration</strong> makes it so only 1 flowfile will transfer through this processor every 6 seconds.</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/controlRate_config_property_tab_window.png" alt="controlRate_config_property_tab_window" /></p>

<p><strong>Figure 5:</strong> ControlRate Configuration Property Tab Window</p>

<p>2. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> checkbox. Click <strong>Apply</strong>.</p>

<p>3. Connect <strong>ControlRate</strong> to <strong>EvaluateXPath</strong> processor. When the Create Connection window appears, verify <strong>success</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="step-23-build-key-attribute-extraction-dataflow-section-">Step 2.3: Build Key Attribute Extraction DataFlow Section <a id="build-key-attributes-extraction"></a></h3>

<h3 id="231-evaluatexpath">2.3.1 EvaluateXPath</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 6 and if the original properties already have values, update them. For the second property in Table 6, add a new dynamic property for XPath expression, select the <strong>New property</strong> button. Insert the following property name and value into your properties tab as shown in the table below:</p>

<p><strong>Table 6:</strong> Update EvaluateXPath Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Destination</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">flowfile-attribute</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Last_Time</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//body/lastTime/@time</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><strong>Destination</strong> result from XPath evaluation stored into FlowFile attribute</p>
  </li>
  <li>
    <p><strong>Last_Time</strong> is a FlowFile Attribute and XPath expression that retrieves value of time node in the XML file</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/evaluateXPath_config_property_tab_window.png" alt="evaluateXPath_config_property_tab_window" /></p>

<p><strong>Figure 6:</strong> EvaluateXPath Configuration Property Tab Window</p>

<p>3. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>unmatched</strong> checkboxes. Click <strong>Apply</strong>.</p>

<p>4. Connect <strong>EvaluateXPath</strong> to <strong>SplitXML</strong> processor. When the Create Connection window appears, verify <strong>matched</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="232-splitxml">2.3.2 SplitXML</h3>

<p>1. Keep SplitXML configuration <strong>properties</strong> as default.</p>

<p>2.  Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>original</strong> checkboxes. Click Apply.</p>

<p>3. Connect <strong>SplitXML</strong> to <strong>EvaluateXPath</strong> processor. When the Create Connection window appears, verify <strong>split</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="233-evaluatexpath">2.3.3 EvaluateXPath</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 7 and if their original properties already have values, update them. For the remaining properties in Table 7, add new dynamic properties for XPath expressions, click on the <strong>New property</strong> button. Insert the following property name and value into your properties tab as shown in the table below:</p>

<p><strong>Table 7:</strong> Update EvaluateXPath Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Destination</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">flowfile-attribute</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Direction_of_Travel</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//vehicle/@dirTag</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Latitude</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//vehicle/@lat</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Longitude</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//vehicle/@lon</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Vehicle_ID</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//vehicle/@id</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Vehicle_Speed</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">//vehicle/@speedKmHr</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p><strong>Destination</strong> set to FlowFile attribute because the result of values from XPath expressions need to be stored in FlowFile attributes.</p>
  </li>
  <li>
    <p><strong>5 user-defined attributes</strong> each hold a value that is used in NiFi Expression language filtering condition in the next processor.</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/evaluateXPath_extract_splitFlowFiles_config_property_tab.png" alt="evaluateXPath_extract_splitFlowFiles_config_property_tab" /></p>

<p><strong>Figure 8:</strong> EvaluateXPath Configuration Property Tab Window</p>

<p>2. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>unmatched</strong> checkboxes. Click <strong>Apply</strong>.</p>

<p>3. Connect <strong>EvaluateXPath</strong> to <strong>RouteOnAttribute</strong> processor. When the Create Connection window appears, verify <strong>matched</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="step-24-build-filter-and-json-conversion-dataflow-section-">Step 2.4: Build Filter and JSON Conversion DataFlow Section <a id="build-filter-json-conversion"></a></h3>

<h3 id="241-routeonattribute">2.4.1 RouteOnAttribute</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add a new dynamic property for NiFi expression, select the <strong>New property</strong> button. Insert the following property name and value into your properties tab as shown in the table below:</p>

<p><strong>Table 8:</strong> Add RouteOnAttribute Property Value</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Filter_Attributes</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">${Direction_of_Travel:isEmpty():not():and(${Last_Time:isEmpty():not()}):and(${Latitude:isEmpty():not()}):and(${Longitude:isEmpty():not()}):and(${Vehicle_ID:isEmpty():not()}):and(${Vehicle_Speed:equals('0'):not()})}</code></td>
    </tr>
  </tbody>
</table>

<p><strong>Filter_Attributes</strong> uses the FlowFile Attribute values obtained from XPath Expressions to filter out any FlowFiles that either have at least one empty Attribute value or the speed attribute value equals 0. Else the FlowFiles are passed to the remaining processors.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/routeOnAttribute_config_property_tab_window.png" alt="routeOnAttribute_config_property_tab_window" /></p>

<p><strong>Figure 9:</strong> RouteOnAttribute Configuration Property Tab Window</p>

<p>2. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>unmatched</strong> checkbox. Click <strong>Apply</strong>.</p>

<p>3. Connect <strong>RouteOnAttribute</strong> to <strong>AttributesToJSON</strong> processor. When the Create Connection window appears, verify <strong>Filter_Attributes</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="242-attributestojson">2.4.2 AttributesToJSON</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 9 and if their original properties already have values, update them.</p>

<p><strong>Table 9:</strong> Update AttributesToJSON Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Attributes List</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">Vehicle_ID, Direction_of_Travel, Latitude, Longitude, Vehicle_Speed, Last_Time</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Destination</code></td>
      <td style="text-align: right">flowfile-content</td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>Attributes List</strong> takes FlowFile attribute parameters and presents them in JSON format</li>
  <li><strong>Destination</strong> stores the output as content in the FlowFile</li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/attributesToJSON_config_property_tab_window.png" alt="attributesToJSON_config_property_tab_window" /></p>

<p><strong>Figure 10:</strong> AttributesToJSON Configuration Property Tab Window</p>

<p>3. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> checkbox. Click <strong>Apply</strong>.</p>

<p>4. Connect <strong>AttributesToJSON</strong> to <strong>MergeContent</strong> processor. When the Create Connection window appears, verify <strong>success</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="243-mergecontent">2.4.3 MergeContent</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the properties listed in Table 10 and if their original properties already have values, update them.</p>

<p><strong>Table 10:</strong> Update MergeContent Property Values</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Minimum Number of Entries</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">10</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Maximum Number of Entries</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">15</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Delimiter Strategy</code></td>
      <td style="text-align: right">Text</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Header</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">[</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Footer</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">]</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Demarcator</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">,</code> {now-press-shift-enter}</td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>Minimum Number of Entries</strong> takes in at least specified amount of FlowFiles, then merges them into 1 FlowFiles</li>
  <li><strong>Maximum Number of Entries</strong> takes in no more than specified amount of FlowFiles, then merges them</li>
  <li><strong>Delimiter Strategy</strong> specifies that Header, Footer and Demarcator set the formatting conditions for text in the file</li>
  <li><strong>Header</strong> inserts specified value at the beginning of the file</li>
  <li><strong>Footer</strong> inserts specified value at the end of the file</li>
  <li><strong>Demarcator</strong> inserts specified value(s) at the end of every line in the file</li>
</ul>

<p>3. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>original</strong> checkboxes. Click <strong>Apply</strong>.</p>

<p>4. Connect <strong>MergeContent</strong> to <strong>UpdateAttribute</strong> processor. When the Create Connection window appears, verify <strong>merged</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="244-updateattribute">2.4.4 UpdateAttribute</h3>

<p>1. Add a new dynamic property for NiFi expression, click on the <strong>New property</strong> button. Insert the following property name and value into your properties tab as shown in the table below:</p>

<p><strong>Table 11:</strong> Add UpdateAttribute Property Value</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">filename</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">${UUID()}</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>filename</strong> updates each FlowFile with a unique identifier</li>
</ul>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/updateAttribute_config_property_tab_window.png" alt="updateAttribute_config_property_tab_window" /></p>

<p><strong>Figure 7:</strong> UpdateAttribute Configuration Property Tab Window</p>

<p>2. Connect <strong>UpdateAttribute</strong> to <strong>PutFile</strong> processor. When the Create Connection window appears, verify <strong>success</strong> checkbox is checked, if not check it. Click Add.</p>

<h3 id="245-putfile">2.4.5 PutFile</h3>

<p>1. Open the processor configuration <strong>properties</strong> tab. Add the property listed in Table 11 and if their original property already has a value, update it.</p>

<p><strong>Table 12:</strong> Update PutFile Property Value</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Property</th>
      <th style="text-align: right">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">Directory</code></td>
      <td style="text-align: right"><code class="highlighter-rouge">/tmp/nifi/output/filtered_transitLoc_data</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/putFile_config_property_tab_window.png" alt="putFile_config_property_tab_window" /></p>

<p><strong>Figure 12:</strong> PutFile Configuration Property Tab Window</p>

<p>3. Open the processor config <strong>Settings</strong> tab, under Auto terminate relationships, check the <strong>failure</strong> and <strong>success</strong> checkboxes. Click <strong>Apply</strong>.</p>

<h3 id="step-25-run-the-nifi-dataflow-">Step 2.5: Run the NiFi DataFlow <a id="run-nifi-dataflow-tutorial1"></a></h3>

<p>1. The processors are valid since the warning symbols disappeared. Notice that the processors have a red stop symbol <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/stop_symbol_nifi_iot.png" alt="stop_symbol_nifi_iot" /> in the upper left corner and are ready to run. To select all processors, hold down the <strong>shift-key</strong> and drag your mouse across the entire data flow.</p>

<p>2. Now that all processors are selected, go to the actions toolbar in the left window labeled Operate and click the start button <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/start_button_nifi_iot.png" alt="start_button_nifi_iot" />. Your screen should look like the following:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/run_dataflow_lab1_nifi_learn_ropes.png" alt="run_dataflow_lab1_nifi_learn_ropes" /></p>

<p>3. To quickly see what the processors are doing and the information on their faces, right click on the graph, click the <strong>refresh status</strong> button <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/refresh_nifi_iot.png" alt="refresh_nifi_iot" /></p>

<p>There are two options for checking that the data stored in the destination is correct. Option 1 is to navigate by terminal to the folder where NiFi stores the data. Option 2 is to use Data Provenance to verify the data is correct.</p>

<h3 id="check-data-by-terminal-option-1">Check Data By Terminal (Option 1)</h3>

<p>4. To check that the data was written to a file, open your terminal or use NiFi’s Data Provenance. Make sure to SSH into your sandbox. Navigate to the directory you wrote for the PutFile processor. List the files and open one of the newly created files to view filtered transit output. In the tutorial our directory path is: <code class="highlighter-rouge">/tmp/nifi/output/filtered_transitLoc_data</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /tmp/nifi/output/filtered_transitLoc_data
ls
vi 19bad9c1-ae98-439f-8a8b-543fb3ab0ab0
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/commands_enter_sandbox_shell_lab1.png" alt="commands_enter_sandbox_shell_lab1" /></p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/filtered_vehicle_locations_data_nifi_learn_ropes.png" alt="filtered_vehicle_locations_data_nifi_learn_ropes" /></p>

<blockquote>
  <p>Note: to exit the vi editor, press <code class="highlighter-rouge">esc</code> and then type <code class="highlighter-rouge">:q</code>.</p>
</blockquote>

<h3 id="check-data-by-nifis-data-provenance-option-2">Check Data By NiFi’s Data Provenance (Option 2)</h3>

<p>Data Provenance is a unique feature in NiFi that enables the user to check the data from any processor or component while the FlowFiles move throughout the dataflow. Data Provenance is a great tool for troubleshooting issues that may occur in the dataflow. In this section, we will check the Data Provenance for the PutFile processor.</p>

<p>1. Right click on the PutFile processor. Select <code class="highlighter-rouge">Data Provenance</code>. It is the 4th item in the dropdown menu.</p>

<p>2. NiFi will search for provenance events. The window will load with events, select any event. An event is a FlowFile that passes through a processor and the data that is viewable at that particular time. For the tutorial, let’s select the first event by pressing on the view provenance event symbol <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/i_symbol_nifi_lab1.png" alt="i_symbol_nifi_lab1" />.</p>

<p>Provence Event Window:</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/provenance_event_window_lab1.png" alt="provenance_event_window_lab1" /></p>

<p>3. Once you select the event, a Provenance Event Dialog Window will appear. It contains Details, Attributes and Content regarding the particular event. Take a few minutes to view each tab. Let’s navigate to the <code class="highlighter-rouge">Content</code> tab to view the data generated from the FlowFile. NiFi gives the user the option to download or view the content of the event. Click on the <strong>View</strong> button.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/provenance_content_tab_lab1.png" alt="provenance_content_tab_lab1" /></p>

<p>4. NiFi gives the user the option view the data in multiple formats. We will view it in original format.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/event_content_view_window_lab1.png" alt="event_content_view_window_lab1" /></p>

<p>Did you receive the data you expected?</p>

<h2 id="summary-">Summary <a id="summary-tutorial1"></a></h2>

<p>Congratulations! You made it to the end of the tutorial and built a NiFi DataFlow that reads in a live stream simulation from NextBus.com, splits the parent’s children elements from the XML file into separate FlowFiles, extracts nodes from the XML file, makes a filtering decision on the attributes and stores that newly modified data into a file. You also learned how to use NiFi’s Data Provenance feature to view data from a FlowFile that flows through a processor, a powerful feature that enables users to troubleshoot issues in real-time. Feel free to use this feature in the other tutorials. If you are interested in learning more about NiFi, view the following further reading section.</p>

<h2 id="further-reading-">Further Reading <a id="further-reading-tutorial1"></a></h2>

<ul>
  <li><a href="https://hortonworks.com/apache/nifi/">Apache NiFi</a></li>
  <li><a href="https://docs.hortonworks.com/HDPDocuments/HDF2/HDF-2.0.0/bk_user-guide/content/index.html">Hortonworks DataFlow Documentation</a></li>
  <li><a href="https://nifi.apache.org/docs/nifi-docs/html/expression-language-guide.html">NiFi Expression Language Guide</a></li>
  <li><a href="http://www.w3schools.com/xsl/xpath_intro.asp">XPath Expression Tutorial</a></li>
  <li><a href="http://www.w3schools.com/json/">JSON Tutorial</a></li>
</ul>

<h2 id="appendix-a-review-of-the-nifi-dataflow-">Appendix A: Review of the NiFi DataFlow <a id="appendix-a-review-dataflow"></a></h2>

<p>If you want a more in depth review of the dataflow we just built, read the information below, else continue onto the next tutorial.</p>

<p>Vehicle Location XML Simulation Section:
streams the contents of a file from local disk into NiFi, unpacks the zip file and transfers each file as a single FlowFile, controls the rate at which the data flows to the remaining part of the flow.</p>

<p>Extract Attributes From FlowFiles Section:
Splits XML message into many FlowFiles, updates each FlowFile filename attribute with unique name and User Defined XPath Expressions are evaluated against the XML Content to extract the values into user-named Attribute.</p>

<p>Filter Key Attributes to JSON File Section:
Routes FlowFile based on whether it contains all XPath Expressions (attributes) from the evaluation, writes JSON representation of input attributes to FlowFile as content, merges the FlowFiles by concatenating their content together into a single FlowFile and writes the contents of a FlowFile to a directory on the local filesystem.</p>

<h2 id="appendix-b-create-labels-for-processor-groups-">Appendix B: Create Labels for Processor Groups <a id="appendix-b-create-labels"></a></h2>

<p>NiFi DataFlows expand to become enormous pipelines to process data. In large dataflow, it can be difficult to understand what particular actions sections of the dataflow perform on data. Therefore, Labels can be used to make it easier for users to understand the different phases of the dataflow.</p>

<p>Let’s create a label to signify the action that happens in the first phase of our dataflow.</p>

<p>1. Drag the Label icon <img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/label_icon_lab1.png" alt="label_icon_lab1" /> located in the components toolbar onto the canvas. To expand the label, hover toward the right corner, a arrow will appear, click on that edge and drag the label to surround the group of processors.</p>

<p>2. Right click on the label, press configure. A Configure Label window will appear. Click in the Label Value field, type the name <code class="highlighter-rouge">Generate Vehicle Location XML Simulator</code> for the first phase of our dataflow. Choose <code class="highlighter-rouge">18px</code> for Font Size.</p>

<p><img src="https://raw.githubusercontent.com/orendain/big-data-tutorials/master/tutorials/hdf/hdf-2.1/analyze-traffic-pattern-with-apache-nifi/assets/lab1-build-nifi-dataflow/label_first_phase_dataflow_lab1.png" alt="label_first_phase_dataflow_lab1" /></p>

<p>Reference the picture of the dataflow in Step 5 if you would like to assign similar labels used in the dataflow for this tutorial. Feel free to create your own as labels for each phase of the dataflow too.</p>

</div>

<hr>

<div id="tutorial-footer">
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>

  <p>If you need help or have questions with this tutorial, please check HCC for answers to existing questions about this tutorial by using the Find Answers button below.  You can post a new HCC question by using the Ask Questions button below.</p>

  <p>
    <a class="btn" href="https://community.hortonworks.com/topics/tutorial-640.html" role="button">Find Answers</a>
    <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-640&amp;topics=hdf-2.0.0" role="button">Ask Questions</a>
  </p>

  <p>Tutorial Name: <strong>Analyze Traffic Pattern with Apache NiFi</strong></p>
  <p>HCC Tags:<strong> tutorial-640</strong> and <strong>hdf-2.0.0</strong></p>
  <p>If the tutorial has multiple components please indicate which one your question relates to.</p>

  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks GitHub repository and can be contributed to by following the <a href="https://github.com/hortonworks/big-data-tutorials/wiki">Tutorial Contribution Guide</a>.  For issues/bugs/feedback, please <a href="https://github.com/hortonworks/big-data-tutorials/issues/new">submit an issue</a> and we will do our best to resolve it!</p>
</div>

