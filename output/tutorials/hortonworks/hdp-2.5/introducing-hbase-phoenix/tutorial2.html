<div class="tutorial-content">
  <h2 id="introduction">Introduction</h2>

<p>Apache Phoenix is a SQL abstraction layer for interacting with HBase.  Phoenix translates SQL to native HBase API calls.  Phoenix provide JDBC/ODBC and Python drivers.</p>

<p>For more information about Phoenix capabilities, see the <a href="#https://phoenix.apache.org/">Apache Phoenix website</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="http://hortonworks.com/downloads/#sandbox">Download Hortonworks 2.5 Sandbox</a></li>
  <li>Complete the <a href="http://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/">Learning the Ropes of the Hortonworks Sandbox tutorial,</a> you will need it for logging into Ambari as an administrator user.</li>
  <li>Lab 1 : Introduction to HBase Concepts</li>
</ul>

<h2 id="outline">Outline</h2>

<ul>
  <li><a href="#enable-phoenix">1: Enable Phoenix by Ambari</a></li>
  <li><a href="#launch-phoenix-shell">2: Launch Phoenix Shell</a></li>
  <li><a href="#create-phoenix-table">3: Create Phoenix Table on existing HBase table</a></li>
  <li><a href="#inserting-data">4: Inserting Data via Phoenix</a></li>
  <li><a href="#squirrel-phoenix-setup">5: Setting up SQuirrel and Phoenix Integration</a></li>
  <li><a href="#summary">6: Summary</a></li>
</ul>

<h2 id="1-enable-phoenix-by-ambari">1. Enable Phoenix by Ambari<a id="enable-phoenix"></a></h2>

<p>There is no separate installation required for Phoenix. You can enable Phoenix with Ambari:</p>

<p>1/ Go to Ambari and select Services tab &gt; HBase &gt; Configs tab.</p>

<p><img src="assets/config_HBase.png" alt="config_HBase" /></p>

<p>2/ Scroll down to the Phoenix SQL settings.</p>

<p><img src="assets/phoenix_tab.png" alt="phoenix_tab" /></p>

<p>3/ Click the <code class="highlighter-rouge">Enable Phoenix</code> slider button.</p>

<p><img src="assets/enable_phoenix.png" alt="enable_phoenix" /></p>

<p>4/ You have to change 3 more properties. Click on <code class="highlighter-rouge">Advanced Tab</code> and then scroll down to open <code class="highlighter-rouge">Advanced hbase-site</code> section. Add <code class="highlighter-rouge">org.apache.ranger.authorization.hbase.RangerAuthorizationCoprocessor</code> in following three properties:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hbase.coprocessor.master.classes
hbase.coprocessor.region.classes
hbase.coprocessor.regionserver.classes
</code></pre>
</div>

<p><img src="assets/config_HBase1.png" alt="config_HBase1" /></p>

<p>5/ Scroll up and click <code class="highlighter-rouge">Save</code> to get your config change reflected.</p>

<p><img src="assets/save_phoenix_setting.png" alt="save_phoenix_setting" /></p>

<p>A pop up will come to write about the change that you are making. Type <strong>Enabled Phoenix</strong> in it and click <code class="highlighter-rouge">Save</code>.</p>

<p><img src="assets/save_phoenix_setting_popup.png" alt="save_phoenix_setting_popup" /></p>

<p>After pressing <code class="highlighter-rouge">Save</code>, you will get a popup like this:</p>

<p><img src="assets/save_configuration_changes.png" alt="save_configuration_changes" /></p>

<p>6/ Restart HBase service.</p>

<p><img src="assets/restart_HBase_service.png" alt="restart_HBase_service" /></p>

<h2 id="2-launch-phoenix-shell-">2. Launch Phoenix Shell <a id="launch-phoenix-shell"></a></h2>

<p>To connect to Phoenix, you need to specify the zookeeper quorum and in the sandbox, it is localhost. To launch it, execute the following commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$&gt;cd /usr/hdp/current/phoenix-client/bin

$&gt;./sqlline.py localhost
</code></pre>
</div>

<p>Your Phoenix shell will look like this:</p>

<p><img src="assets/enter_phoenix_shell.png" alt="enter_phoenix_shell" /></p>

<h2 id="3-create-phoenix-table-on-existing-hbase-table-">3. Create Phoenix Table on existing HBase table <a id="create-phoenix-table"></a></h2>

<p>You can create a Phoenix table/view on a pre-existing HBase table. There is no need to move the data to Phoenix or convert it. Apache Phoenix supports table creation and versioned incremental alterations through DDL commands. The table metadata is stored in an HBase table and versioned. You can either create a READ-WRITE table or a READ only view with a condition that the binary representation of the row key and key values must match that of the Phoenix data types. The only addition made to the HBase table is Phoenix coprocessors used for query processing. A table can be created with the same name.</p>

<blockquote>
  <p><strong>NOTE</strong>: The DDL used to create the table is case sensitive and if HBase table name is in lowercase, you have to put the name in between double quotes. In HBase, you donâ€™t model the possible KeyValues or the structure of the row key. This is the information you specify in Phoenix and beyond the table and column family.</p>
</blockquote>

<p>Create a Phoenix table from existing HBase table by writing a code like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>create table "driver_dangerous_event" ("row" VARCHAR primary key,"events"."driverId" VARCHAR,"events"."driverName" VARCHAR,
"events"."eventTime" VARCHAR,"events"."eventType" VARCHAR,"events"."latitudeColumn" VARCHAR,
"events"."longitudeColumn" VARCHAR,"events"."routeId" VARCHAR,"events"."routeName" VARCHAR,
"events"."truckId" VARCHAR);
</code></pre>
</div>

<p><img src="assets/create_table_phoenix.png" alt="create_phoenix_table" /></p>

<p>You can view the HBase table data from this Phoenix table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>select * from "driver_dangerous_event";
</code></pre>
</div>

<p><img src="assets/select_data_phoenix.png" alt="select_data_phoenix" /></p>

<p>If you want to change the view from horizontal to vertical, type the following command in the shell and then try to view the data again:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>!outputformat vertical

select * from "driver_dangerous_event";
</code></pre>
</div>

<p><img src="assets/select_data_phoenix1.png" alt="select_data_phoenix1" /></p>

<p>If you do not like this view, you can change it back to horizontal view by running the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>!outputformat horizontal
</code></pre>
</div>

<p>So with all existing HBase tables, you can query them with SQL now. You can point your Business Intelligence tools and Reporting Tools and other tools which work with SQL and query HBase as if it was another SQL database with the help of Phoenix.</p>

<h2 id="4-inserting-data-via-phoenix-">4: Inserting Data via Phoenix <a id="inserting-data"></a></h2>

<p>You can insert the data using <code class="highlighter-rouge">UPSERT</code> command. It inserts if not present and updates otherwise the value in the table. The list of columns is optional and if not present, the values will map to the column in the order they are declared in the schema. Copy the <code class="highlighter-rouge">UPSERT</code> statement given below and then view the newly added row.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>UPSERT INTO "driver_dangerous_event" values('5','23','Matt','2016-02-29 12:35:21.739','Abnormal','23.385908','-101.384927','249','San Tomas to San Mateo','814');

select * from "driver_dangerous_event";
</code></pre>
</div>

<p><img src="assets/upsert_data_phoenix.png" alt="upsert_data_phoenix" /></p>

<p>You will see a newly added row:</p>

<p><img src="assets/upsert_data_phoenix1.png" alt="upsert_data_phoenix1" /></p>

<h2 id="5-setting-up-squirrel-and-phoenix-integration-">5. Setting up SQuirrel and Phoenix Integration <a id="squirrel-phoenix-setup"></a></h2>

<p><strong>SQuirreL SQL Client</strong> is a graphical Java program that will allow you to view the structure of a JDBC compliant database, browse the data in tables, issue SQL commands etc. If you want to use a graphical user interface for Phoenix, you might give SQuirrel a try.</p>

<p>Go to this <a href="https://community.hortonworks.com/content/kbentry/44350/setting-up-squirrel-and-phoenix-integration.html">article</a> on Hortonworks Community Connection to set up the SQuirrel client work with Phoenix.</p>

<h2 id="6-summary-">6. Summary <a id="summary"></a></h2>

<p>Congratulations! Lets summarize what we learned in this tutorial. We went through the introduction of Apache Phoenix and how to use it with Apache HBase. We also learned how to integrate Phoenix with SQuirrel. Go through Lab 3 of this tutorial where we are discussing another SQL tool Apache Hive and how to integrate that with Apache HBase.</p>

</div>

<div id="tutorial-footer">
  <hr>
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>
  <p>If you need help or have questions with this tutorial, please first check HCC for existing Answers to questions on this tutorial using the Find Answers button.  If you don't find your answer you can post a new HCC question for this tutorial using the Ask Questions button.</p>
  <p><a class="btn" href="https://community.hortonworks.com/topics/tutorial-/tutorials/hortonworks/hdp-2.5/introducing-hbase-phoenix/tutorial2.html" role="button">Find Answers</a> <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-hdp-2.5.0&topics=hdp-2.5.0" role="button">Ask Questions</a></p>
  <p>Tutorial Name: <strong>Introduction to Phoenix Concepts</strong></p>
  <p>HCC Tutorial Tag:<strong> tutorial-/tutorials/hortonworks/hdp-2.5/introducing-hbase-phoenix/tutorial2</strong> and <strong>hdp-2.5.0</strong></p>
  <p>If the tutorial has multiple labs please indicate which lab your question corresponds to. Please provide any feedback related to that lab.</p>
  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks github and can be contributed via the <a href="https://github.com/hortonworks/tutorials/wiki">Hortonworks Tutorial Contribution Guide</a>.  If you are certain there is an issue or bug with the tutorial, please <a href="https://github.com/hortonworks/tutorials/wiki#issues-with-tutorials">create an issue</a> on the repository and we will do our best to resolve it!</p>
</div>

