<div class="tutorial-content">
  <h1 id="lab-2-visualize-clickstream-log-data">Lab 2: Visualize Clickstream Log Data</h1>

<h2 id="introduction">Introduction</h2>

<p>In this section, You can choose to use  Excel Professional Plus 2013  or Apache Zeppelin (built in to the sandbox) to access the refined clickstream data.</p>

<h3 id="prerequisites">Prerequisites:</h3>

<ul>
  <li>Hortonworks Sandbox 2.5 (installed and running)</li>
  <li>Completed Lab 1</li>
</ul>

<h2 id="outline">Outline</h2>
<ul>
  <li><a href="visualize-data-zeppelin">Section 1: Visualize Data with Apache Zeppelin</a></li>
  <li><a href="identify-customers-website">Step 1: Identify from which State’s Customers Visit the Website Most</a></li>
  <li><a href="demographics-pull-customers">Step 2: Understand Demographics from Data to Pull in More Customers</a></li>
  <li><a href="interest-category-distribution">Step 3: Analyze the Interest Category Distribution for Users</a></li>
  <li><a href="visualize-data-excel">Section 2: Visualize Data with Excel</a></li>
  <li><a href="connect-excel">Step 1: Connect Microsoft Excel</a></li>
  <li><a href="visualize-web-clickstream-excel">Step 2: Visualize the Website Clickstream Data Using Excel Power View</a></li>
  <li><a href="summary-clickstream">Summary</a></li>
</ul>

<hr />

<h2 id="section-1-visualize-data-with-apache-zeppelin-">Section 1: Visualize Data with Apache Zeppelin <a id="visualize-data-zeppelin"></a></h2>

<h3 id="analyze-clickstream-data-with-apache-zeppelin">Analyze Clickstream Data with Apache Zeppelin</h3>

<p>If you don’t have access to Microsoft Excel Professional Plus, you can also utilize Apache Zeppelin to do you data visualization as well.</p>

<p>Open up Ambari and make sure Zeppelin is running. If not, start the service. Go to browser and type <code class="highlighter-rouge">sandbox.hortonworks.com:9995</code> to open Zeppelin UI.
<!---Then use the dropdown menu to access the views and select **Zeppelin**---></p>

<p><img src="assets/36_zeppelin_create_note.png" alt="Zeppelin View" /></p>

<p>Once the Zeppelin UI is open you can either create a new note and run the commands, or import the following notebook from this URL: `</p>

<p><code class="highlighter-rouge">https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.4/data/zeppelin-notes/ClickstreamAnalytics.json</code></p>

<hr />

<h3 id="step-1-identify-from-which-states-customers-visit-the-website-most-">Step 1: Identify from which State’s Customers Visit the Website Most <a id="identify-customers-website"></a></h3>

<ul>
  <li>Write the query to filter states</li>
  <li>open <strong>settings</strong>, make sure <code class="highlighter-rouge">state COUNT</code> is in the <strong>Values</strong> field</li>
  <li>select <code class="highlighter-rouge">bar graph</code> to represent the data visually</li>
</ul>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">jdbc</span><span class="p">(</span><span class="n">hive</span><span class="p">)</span>
<span class="k">select</span> <span class="k">state</span> <span class="k">from</span> <span class="n">webloganalytics</span>
</code></pre>
</div>

<p><img src="assets/zeppelin-chart-1.png" alt="Zeppelin Bar Graph" /></p>

<p>Therefore, we have better idea of where our customers are coming from.
Which are the top three states that have customers who view the website most?</p>

<hr />

<h3 id="step-2-understand-demographics-from-data-to-pull-in-more-customers-">Step 2: Understand Demographics from Data to Pull in More Customers <a id="demographics-pull-customers"></a></h3>
<ul>
  <li>Write the query to filter demographics (age, gender, category)</li>
  <li>open <strong>settings</strong>, make sure
    <ul>
      <li><code class="highlighter-rouge">age</code> is in <strong>Keys</strong> field,</li>
      <li><code class="highlighter-rouge">gender_cd</code> is in <strong>Groups</strong> field,</li>
      <li><code class="highlighter-rouge">category COUNT</code> is in <strong>Values</strong> field</li>
    </ul>
  </li>
  <li>select <code class="highlighter-rouge">area chart</code></li>
</ul>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">jdbc</span><span class="p">(</span><span class="n">hive</span><span class="p">)</span>
<span class="k">select</span> <span class="n">age</span><span class="p">,</span> <span class="n">gender_cd</span><span class="p">,</span> <span class="n">category</span> <span class="k">from</span> <span class="n">webloganalytics</span> <span class="k">where</span> <span class="n">age</span> <span class="k">is</span> <span class="k">not</span> <span class="k">NULL</span> <span class="k">LIMIT</span> <span class="mi">1000</span>
</code></pre>
</div>

<p><img src="assets/zeppelin-chart-2.png" alt="Zeppelin Area Chart" /></p>

<p>Thus, the majority of users who come into the website are within age range of 20-30. Additionally, there seems to be an even split between both genders.
Which gender seems to dominate the website views for the older age?</p>

<hr />

<h3 id="step-3-analyze-the-interest-category-distribution-for-users-">Step 3: Analyze the Interest Category Distribution for Users <a id="interest-category-distribution"></a></h3>

<ul>
  <li>Write the query to find the number of users interested toward particular categories</li>
  <li>open <strong>settings</strong>, make sure
    <ul>
      <li><code class="highlighter-rouge">category</code> is in <strong>Keys</strong> field</li>
      <li><code class="highlighter-rouge">category SUM</code> is in <strong>Values</strong> field</li>
    </ul>
  </li>
  <li>select <code class="highlighter-rouge">pie chart</code></li>
</ul>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">jdbc</span><span class="p">(</span><span class="n">hive</span><span class="p">)</span>
<span class="k">select</span> <span class="n">category</span> <span class="k">from</span> <span class="n">webloganalytics</span>
</code></pre>
</div>

<p><img src="assets/zeppelin-chart-3.png" alt="Zeppelin Pie Chart" /></p>

<p>Hence, clothing is clearly the most popular reason customers visit the website.
What are the next two interest categories that are most popular?</p>

<hr />

<h2 id="section-2-visualize-data-with-excel-">Section 2: Visualize Data with Excel <a id="visualize-data-excel"></a></h2>

<h3 id="step-1-connect-microsoft-excel-">Step 1: Connect Microsoft Excel <a id="connect-excel"></a></h3>

<ul>
  <li>In Windows, open a new Excel workbook, then select <strong>Data &gt; From Other Sources &gt; From Microsoft Query</strong>.</li>
</ul>

<p><img src="assets/11_open_query.jpg" alt="" /></p>

<ul>
  <li>On the Choose Data Source pop-up, select the Hortonworks ODBC data source you installed previously, then click <strong>OK</strong>. The Hortonworks ODBC driver enables you to access Hortonworks data with Excel and other Business Intelligence (BI) applications that support ODBC.</li>
</ul>

<p><img src="assets/12_choose_data_source.jpg" alt="" /></p>

<ul>
  <li>After the connection to the sandbox is established, the Query Wizard appears. Select the webloganalytics table in the Available tables and columns box, then click the right arrow button to add the entire webloganalytics table to the query. Click <strong>Next</strong> to continue.</li>
</ul>

<p><img src="assets/13_query_wizard1.jpg" alt="" /></p>

<ul>
  <li>On the Filter Data screen, click <strong>Next</strong> to continue without filtering the data.</li>
</ul>

<p><img src="assets/14_query_wizard2.jpg" alt="" /></p>

<ul>
  <li>On the Sort Order screen, click <strong>Next</strong> to continue without setting a sort order.</li>
</ul>

<p><img src="assets/15_query_wizard3.jpg" alt="" /></p>

<ul>
  <li>Click <strong>Finish</strong> on the Query Wizard Finish screen to retrieve the query data from the sandbox and import it into Excel.</li>
</ul>

<p><img src="assets/16_query_wizard4.jpg" alt="" /></p>

<ul>
  <li>On the Import Data dialog box, click <strong>OK</strong> to accept the default settings and import the data as a table.</li>
</ul>

<p><img src="assets/17_import_data.jpg" alt="" /></p>

<ul>
  <li>The imported query data appears in the Excel workbook.</li>
</ul>

<p><img src="assets/18_data_imported.jpg" alt="" /></p>

<p>Now that we have successfully imported Hortonworks Sandbox data into Microsoft Excel, we can use the Excel Power View feature to analyze and visualize the data.</p>

<hr />

<h3 id="step-2-visualize-the-website-clickstream-data-using-excel-power-view-">Step 2: Visualize the Website Clickstream Data Using Excel Power View <a id="visualize-web-clickstream-excel"></a></h3>

<p>Data visualization can help you optimize your website and convert more visits into sales and revenue. In this section we will:</p>

<ul>
  <li>Analyze the clickstream data by location</li>
  <li>Filter the data by product category</li>
  <li>Graph the website user data by age and gender</li>
  <li>Pick a target customer segment</li>
  <li>Identify a few web pages with the highest bounce rates</li>
</ul>

<p>In the Excel workbook with the imported webloganalytics data, select <strong>Insert &gt; Power View</strong> to open a new Power View report.</p>

<p><img src="assets/19_open_powerview.jpg" alt="" /></p>

<ul>
  <li>The Power View Fields area appears on the right side of the window, with the data table displayed on the left. Drag the handles or click the Pop Out icon to maximize the size of the data table.</li>
</ul>

<p><img src="assets/20_powerview_initial_popout.jpg" alt="" /></p>

<ul>
  <li>Let’s start by taking a look at the countries of origin of our website visitors. In the Power View Fields area, leave the <strong>country</strong> checkbox selected, and clear all of the other checkboxes. The data table will update to reflect the selections.</li>
</ul>

<p><img src="assets/21_country_selected.jpg" alt="" /></p>

<ul>
  <li>On the Design tab in the top menu, click <strong>Map</strong>.</li>
</ul>

<p><img src="assets/22_open_map.jpg" alt="" /></p>

<ul>
  <li>The map view displays a global view of the data. Now let’s take a look at a count of IP address by state. First, drag the <strong>ip</strong> field into the SIZE box.</li>
</ul>

<p><img src="assets/23_add_ip_count.jpg" alt="" /></p>

<ul>
  <li>Drag <strong>country</strong> from the Power View Fields area into the Filters area, then select the <strong>usa</strong> checkbox.</li>
</ul>

<p><img src="assets/24_filter_by_usa.jpg" alt="" /></p>

<ul>
  <li>Next, drag <strong>state</strong> into the LOCATIONS box. Remove the <strong>country</strong> field from the LOCATIONS box by clicking the down-arrow and then <strong>Remove Field</strong>.</li>
</ul>

<p><img src="assets/25_state_to_locations.jpg" alt="" /></p>

<ul>
  <li>Use the map controls to zoom in on the United States. Move the pointer over each state to display the IP count for that state.</li>
</ul>

<p><img src="assets/26_ip_count_by_state.jpg" alt="" /></p>

<ul>
  <li>Our dataset includes product data, so we can display the product categories viewed by website visitors in each state. To display product categories in the map by color, drag the <strong>category</strong> field into the COLOR box.</li>
</ul>

<p><img src="assets/27_category_by_color.jpg" alt="" /></p>

<ul>
  <li>The map displays the product categories by color for each state. Move the pointer over each state to display detailed category information. We can see that the largest number of page hits in Florida were for clothing, followed by shoes.</li>
</ul>

<p><img src="assets/28_category_by_color_florida.jpg" alt="" /></p>

<ul>
  <li>Now let’s look at the clothing data by age and gender so we can optimize our content for these customers. Select <strong>Insert &gt; Power View</strong> to open a new Power View report.</li>
</ul>

<p><img src="assets/29_new_powerview1.jpg" alt="" /></p>

<p>To set up the data, set the following fields and filters:</p>

<ul>
  <li>In the Power View Fields area, select <strong>ip</strong> and <strong>age</strong>. All of the other fields should be unselected.</li>
  <li>Drag <strong>category</strong> from the Power View Fields area into the Filters area, then select the <strong>clothing</strong> checkbox.</li>
  <li>Drag <strong>gender</strong> from the Power View Fields area into the Filters area, then select the <strong>M</strong> (male) checkbox.</li>
</ul>

<p>After setting these fields and filters, select <strong>Column Chart &gt; Clustered Column</strong> in the top menu.</p>

<p><img src="assets/30_open_clustered_column1.jpg" alt="" /></p>

<ul>
  <li>To finish setting up the chart, drag <strong>age</strong> into the AXIS box. Also, remove <strong>ip</strong> from the AXIS box by clicking the down-arrow and then <strong>Remove Field</strong>. The chart shows that the majority of men shopping for clothing on our website are between the ages of 22 and 30. With this information, we can optimize our content for this market segment.</li>
</ul>

<p><img src="assets/31_clothing_by_age.jpg" alt="" /></p>

<ul>
  <li>Let’s assume that our data includes information about website pages (URLs) with high bounce rates. A page is considered to have a high bounce rate if it is the last page a user visited before leaving the website. By filtering this URL data by our target age group, we can find out exactly which website pages we should optimize for this market segment. Select <strong>Insert &gt; Power View</strong> to open a new Power View report.</li>
</ul>

<p><img src="assets/32_new_powerview2.jpg" alt="" /></p>

<p>To set up the data, set the following fields and filters:</p>

<ul>
  <li>Drag <strong>age</strong> from the Power View Fields area into the Filters area, then drag the sliders to set the age range from 22 to 30.</li>
  <li>Drag <strong>gender</strong> from the Power View Fields area into the Filters area, then select the <strong>M</strong> (male) checkbox.</li>
  <li>Drag <strong>country</strong> from the Power View Fields area into the Filters area, then select the <strong>usa</strong> checkbox.</li>
  <li>In the Power View Fields area, select <strong>url</strong>. All of the other fields should be unselected.</li>
  <li>In the Power View Fields area, move the pointer over <strong>url</strong>, click the down-arrow, and then select <strong>Add to Table as Count.</strong></li>
</ul>

<p>After setting these fields and filters, select <strong>Column Chart &gt; Clustered Column</strong> in the top menu.</p>

<p><img src="assets/33_open_clustered_column2.jpg" alt="" /></p>

<ul>
  <li>The chart shows that we should focus on optimizing four of our website pages for the market segment of men between the ages of 22 and 30. Now we can redesign these four pages and test the new designs based on our target demographic, thereby reducing the bounce rate and increasing customer retention and sales.</li>
</ul>

<p><img src="assets/34_urls_for_age_group.jpg" alt="" /></p>

<ul>
  <li>You can use the controls in the upper left corner of the map to sort by Count of URL in ascending order.</li>
</ul>

<p><img src="assets/35_urls_for_age_group_sorted.jpg" alt="" /></p>

<hr />

<h2 id="summary-">Summary <a id="summary-clickstream"></a></h2>

<p>Now that you have successfully analyzed and visualized Hortonworks Sandbox data with Microsoft Excel, you can see how Excel and other BI tools can be used with the Hortonworks platform to derive insights about customers from various data sources.</p>

<p>The data in the Hortonworks platform can be refreshed frequently and used for basket analysis, A/B testing, personalized product recommendations, and other sales optimization activities.</p>

<hr />

<h2 id="further-reading-">Further Reading <a id="further-reading"></a></h2>
<ul>
  <li><a href="https://community.hortonworks.com/content/repo/56765/zeppelin-notebook-for-analysing-web-server-logs.html">Zeppelin Notebook for Analysing Web Server Logs</a></li>
  <li><a href="http://hortonworks.com/apache/zeppelin/#blog">Zeppelin in Hortonworks Blog</a></li>
</ul>

</div>

<div id="tutorial-footer">
  <hr>
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>
  <p>If you need help or have questions with this tutorial, please first check HCC for existing Answers to questions on this tutorial using the Find Answers button.  If you don't find your answer you can post a new HCC question for this tutorial using the Ask Questions button.</p>
  <p><a class="btn" href="https://community.hortonworks.com/topics/tutorial-/tutorials/hortonworks/hdp-2.5/visualizing-website-clickstream-data/tutorial-2.html" role="button">Find Answers</a> <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-hdp-2.5.0&topics=hdp-2.5.0" role="button">Ask Questions</a></p>
  <p>Tutorial Name: <strong>How to Visualize Website Clickstream Data</strong></p>
  <p>HCC Tutorial Tag:<strong> tutorial-/tutorials/hortonworks/hdp-2.5/visualizing-website-clickstream-data/tutorial-2</strong> and <strong>hdp-2.5.0</strong></p>
  <p>If the tutorial has multiple labs please indicate which lab your question corresponds to. Please provide any feedback related to that lab.</p>
  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks github and can be contributed via the <a href="https://github.com/hortonworks/tutorials/wiki">Hortonworks Tutorial Contribution Guide</a>.  If you are certain there is an issue or bug with the tutorial, please <a href="https://github.com/hortonworks/tutorials/wiki#issues-with-tutorials">create an issue</a> on the repository and we will do our best to resolve it!</p>
</div>

