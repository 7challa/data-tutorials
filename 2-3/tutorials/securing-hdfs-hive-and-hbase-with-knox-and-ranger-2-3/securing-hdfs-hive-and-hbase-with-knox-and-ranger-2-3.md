<h3><a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h3>
<p>Apache Ranger delivers a comprehensive approach to security for a Hadoop cluster. It provides central security policy administration across the core enterprise security requirements of authorization, accounting and data protection.</p>
<p>Apache Ranger already extends baseline features for coordinated enforcement across Hadoop workloads from batch, interactive SQL and real–time in Hadoop.</p>
<p>In this tutorial, we cover using Apache Ranger for HDP 2.3 to secure your Hadoop environment. We will walkthrough the following topics:</p>
<ol>
<li>Support for Knox authorization and audit</li>
<li>Command line policies in Hive</li>
<li>Command line policies in HBase</li>
<li>REST APIs for policy manager</li>
</ol>
<h3><a id="user-content-prerequisite" class="anchor" href="#prerequisite" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisite</h3>
<p>The only prerequisite for this tutorial is that you have <a href="http://hortonworks.com/sandbox">Hortonworks Sandbox</a>.</p>
<p>Once you have Hortonworks Sandbox, login through SSH:</p>
<p><a href="https://camo.githubusercontent.com/3c93256939c628bbe032b0ce5ea939f1fca851da/687474703a2f2f7777772e64726f70626f782e636f6d2f732f357863767431796d786565383279692f53637265656e73686f74253230323031352d30392d303225323031342e35392e30332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/3c93256939c628bbe032b0ce5ea939f1fca851da/687474703a2f2f7777772e64726f70626f782e636f6d2f732f357863767431796d786565383279692f53637265656e73686f74253230323031352d30392d303225323031342e35392e30332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/5xcvt1ymxee82yi/Screenshot%202015-09-02%2014.59.03.png?dl=1" style="max-width:100%;"></a></p>
<h3><a id="user-content-starting-knox-service-and-demo-ldap-service" class="anchor" href="#starting-knox-service-and-demo-ldap-service" aria-hidden="true"><span class="octicon octicon-link"></span></a>Starting Knox Service and Demo LDAP Service</h3>
<p>From the Ambari console at <a href="http://localhost:8080/" class="ext-link" target="_blank">http://localhost:8080/</a> (username and password is <code class=" prettyprinted"><span class="pln">admin</span></code> and <code class=" prettyprinted"><span class="pln">admin</span></code> respectively), select Knox from the list of <code class=" prettyprinted"><span class="typ">Services</span></code> on the left-hand side of the page.<br>
<a href="https://camo.githubusercontent.com/66f46fb9f3d013432f70110b3e8fae07c298107a/687474703a2f2f7777772e64726f70626f782e636f6d2f732f30766676766f626a756e6d7a6167672f53637265656e73686f74253230323031352d30392d303825323031302e31372e30352e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/66f46fb9f3d013432f70110b3e8fae07c298107a/687474703a2f2f7777772e64726f70626f782e636f6d2f732f30766676766f626a756e6d7a6167672f53637265656e73686f74253230323031352d30392d303825323031302e31372e30352e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/0vfvvobjunmzagg/Screenshot%202015-09-08%2010.17.05.png?dl=1" style="max-width:100%;"></a></p>
<p>Then click on <code class=" prettyprinted"><span class="typ">Service</span><span class="pln"> </span><span class="typ">Actions</span></code> from the top right hand side of the page click on <code class=" prettyprinted"><span class="typ">Start</span></code></p>
<p>![]<a href="http://www.dropbox.com/s/jhb30dgey8m30n6/Screenshot%202015-09-08%2010.27.06.png?dl=1" class="ext-link" target="_blank">http://www.dropbox.com/s/jhb30dgey8m30n6/Screenshot%202015-09-08%2010.27.06.png?dl=1</a>)</p>
<p>From the following you can track the start of the Knox service to completion:</p>
<p><a href="https://camo.githubusercontent.com/c3931e9f150091ae51be2db80299763f239bc217/687474703a2f2f7777772e64726f70626f782e636f6d2f732f776b6c6b6366766130686d6c346d312f53637265656e73686f74253230323031352d30392d303825323031302e32302e30312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/c3931e9f150091ae51be2db80299763f239bc217/687474703a2f2f7777772e64726f70626f782e636f6d2f732f776b6c6b6366766130686d6c346d312f53637265656e73686f74253230323031352d30392d303825323031302e32302e30312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/wklkcfva0hml4m1/Screenshot%202015-09-08%2010.20.01.png?dl=1" style="max-width:100%;"></a></p>
<p>Then go back to the <code class=" prettyprinted"><span class="typ">Service</span><span class="pln"> </span><span class="typ">Actions</span></code> button on the <code class=" prettyprinted"><span class="typ">Knox</span></code> service and click on <code class=" prettyprinted"><span class="typ">Start</span><span class="pln"> </span><span class="typ">Demo</span><span class="pln"> LDAP</span></code></p>
<p><a href="https://camo.githubusercontent.com/16d54c667142b64659ab87f3c80555084ba0c4f0/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f7338666a37726863783676623561782f53637265656e73686f74253230323031352d30392d303825323031302e33372e30392e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/16d54c667142b64659ab87f3c80555084ba0c4f0/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f7338666a37726863783676623561782f53637265656e73686f74253230323031352d30392d303825323031302e33372e30392e706e673f646c3d31" alt="" data-canonical-src="https://www.dropbox.com/s/s8fj7rhcx6vb5ax/Screenshot%202015-09-08%2010.37.09.png?dl=1" style="max-width:100%;"></a></p>
<p>You can track the start of the <code class=" prettyprinted"><span class="typ">Demo</span><span class="pln"> LDAP </span><span class="typ">Service</span></code> from the following screen:</p>
<p><a href="https://camo.githubusercontent.com/79e053a98d15e2b76bf998388a589e6395104e25/687474703a2f2f7777772e64726f70626f782e636f6d2f732f35386e38796b6968696c696a6634332f53637265656e73686f74253230323031352d30392d303825323031302e33392e30312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/79e053a98d15e2b76bf998388a589e6395104e25/687474703a2f2f7777772e64726f70626f782e636f6d2f732f35386e38796b6968696c696a6634332f53637265656e73686f74253230323031352d30392d303825323031302e33392e30312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/58n8ykihilijf43/Screenshot%202015-09-08%2010.39.01.png?dl=1" style="max-width:100%;"></a></p>
<h3><a id="user-content-knox-access-scenarios" class="anchor" href="#knox-access-scenarios" aria-hidden="true"><span class="octicon octicon-link"></span></a>Knox access scenarios</h3>
<p>Check if Ranger Admin console is running, at&nbsp;<a href="http://localhost:6080/" class="ext-link" target="_blank">http://localhost:6080/</a>from your host machine. The username is&nbsp;<code class=" prettyprinted"><span class="pln">admin</span></code>&nbsp;and the password is&nbsp;<code class=" prettyprinted"><span class="pln">admin</span></code></p>
<p><a href="https://camo.githubusercontent.com/ffcdfb13991685c1b6a4de80b85bb347082cdc75/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61376135737965757a7677773736732f53637265656e73686f74253230323031352d30392d303825323031302e31312e30312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/ffcdfb13991685c1b6a4de80b85bb347082cdc75/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61376135737965757a7677773736732f53637265656e73686f74253230323031352d30392d303825323031302e31312e30312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/a7a5syeuzvww76s/Screenshot%202015-09-08%2010.11.01.png?dl=1" style="max-width:100%;"></a></p>
<p>If it is not running you can start from the command line using the command</p>
<div class="highlight highlight-bash">
<pre class=" prettyprinted"><span class="pln">sudo service ranger</span><span class="pun">-</span><span class="pln">admin start</span></pre>
</div>
<p><a href="https://camo.githubusercontent.com/dcad6b24d4ddb5b50e93329544b86bd732e95b1f/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f6c65303471333872767a74636e30692f53637265656e73686f74253230323031352d30392d303225323031352e30362e30302e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/dcad6b24d4ddb5b50e93329544b86bd732e95b1f/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f6c65303471333872767a74636e30692f53637265656e73686f74253230323031352d30392d303225323031352e30362e30302e706e673f646c3d31" alt="" data-canonical-src="https://www.dropbox.com/s/le04q38rvztcn0i/Screenshot%202015-09-02%2015.06.00.png?dl=1" style="max-width:100%;"></a></p>
<p>Click on&nbsp;sandbox_knox&nbsp;link under Knox section in the main screen of Ranger Administration Portal</p>
<p><a href="https://camo.githubusercontent.com/a7370b62f765a623863bbc5462682d5bf1f86f8b/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f383930767035397366626d767169712f53637265656e73686f74253230323031352d30392d303825323031302e33302e35382e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/a7370b62f765a623863bbc5462682d5bf1f86f8b/68747470733a2f2f7777772e64726f70626f782e636f6d2f732f383930767035397366626d767169712f53637265656e73686f74253230323031352d30392d303825323031302e33302e35382e706e673f646c3d31" alt="" data-canonical-src="https://www.dropbox.com/s/890vp59sfbmvqiq/Screenshot%202015-09-08%2010.30.58.png?dl=1" style="max-width:100%;"></a></p>
<p>You can review policy details by a clicking on the policy name.</p>
<p><a href="https://camo.githubusercontent.com/63a71f5b1b5c6dac87818ce8618b72e1c11f194b/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a71786c76746c316b37716a6575382f53637265656e73686f74253230323031352d30392d303825323031302e33312e33312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/63a71f5b1b5c6dac87818ce8618b72e1c11f194b/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a71786c76746c316b37716a6575382f53637265656e73686f74253230323031352d30392d303825323031302e33312e33312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/jqxlvtl1k7qjeu8/Screenshot%202015-09-08%2010.31.31.png?dl=1" style="max-width:100%;"></a></p>
<p>To start testing Knox policies, we would need to turn off the “global knox allow” policy.</p>
<p><a href="https://camo.githubusercontent.com/4a99e60014b10ed96c77eb9fd69777a2f0cd9c72/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6870666434766567766b746b3869372f53637265656e73686f74253230323031352d30392d303825323031302e33332e35332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/4a99e60014b10ed96c77eb9fd69777a2f0cd9c72/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6870666434766567766b746b3869372f53637265656e73686f74253230323031352d30392d303825323031302e33332e35332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/hpfd4vegvktk8i7/Screenshot%202015-09-08%2010.33.53.png?dl=1" style="max-width:100%;"></a></p>
<p>Locate <code class=" prettyprinted"><span class="typ">Sandbox</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="typ">Guest</span></code> policy on the Ranger Admin console and edit the policy</p>
<p><a href="https://camo.githubusercontent.com/0dafcf6c3b2aeb65e6c552f8a1ea8222615f6f0f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a346f766a696c626b6378713771342f53637265656e73686f74253230323031352d30392d303825323031302e34352e31372e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/0dafcf6c3b2aeb65e6c552f8a1ea8222615f6f0f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a346f766a696c626b6378713771342f53637265656e73686f74253230323031352d30392d303825323031302e34352e31372e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/j4ovjilbkcxq7q4/Screenshot%202015-09-08%2010.45.17.png?dl=1" style="max-width:100%;"></a></p>
<p>and enable policy named “Sandbox for Guest”</p>
<p><a href="https://camo.githubusercontent.com/51c87e11b36bd05740145f21c1dfc9e22771d5b4/687474703a2f2f7777772e64726f70626f782e636f6d2f732f666276383575646d696d6a726e38742f53637265656e73686f74253230323031352d30392d303825323031302e34372e32382e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/51c87e11b36bd05740145f21c1dfc9e22771d5b4/687474703a2f2f7777772e64726f70626f782e636f6d2f732f666276383575646d696d6a726e38742f53637265656e73686f74253230323031352d30392d303825323031302e34372e32382e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/fbv85udmimjrn8t/Screenshot%202015-09-08%2010.47.28.png?dl=1" style="max-width:100%;"></a></p>
<p>From your local SSHd terminal (not directly on the Sandbox), run this CURL command to access WebHDFS</p>
<p><code class=" prettyprinted"><span class="pln">curl </span><span class="pun">-</span><span class="pln">k </span><span class="pun">-</span><span class="pln">u admin</span><span class="pun">:</span><span class="pln">admin</span><span class="pun">-</span><span class="pln">password </span><span class="str">'https://127.0.0.1:8443/gateway/knox_sample/webhdfs/v1?op=LISTSTATUS'</span></code></p>
<p><a href="https://camo.githubusercontent.com/e911b29420ae5c1aaeb9d68c1dab2bb751c25f51/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61657a6234666174317639776879782f53637265656e73686f74253230323031352d30392d303825323031302e35302e34332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/e911b29420ae5c1aaeb9d68c1dab2bb751c25f51/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61657a6234666174317639776879782f53637265656e73686f74253230323031352d30392d303825323031302e35302e34332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/aezb4fat1v9whyx/Screenshot%202015-09-08%2010.50.43.png?dl=1" style="max-width:100%;"></a></p>
<p>Go to Ranger Policy Manager tool → Audit screen and check the knox access (denied) being audited.</p>
<p><a href="https://camo.githubusercontent.com/b0d071eeb85baac9ddf9dc5b565918e265176571/687474703a2f2f7777772e64726f70626f782e636f6d2f732f31616c316764643871326b7531376f2f53637265656e73686f74253230323031352d30392d303825323031302e35332e34372e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/b0d071eeb85baac9ddf9dc5b565918e265176571/687474703a2f2f7777772e64726f70626f782e636f6d2f732f31616c316764643871326b7531376f2f53637265656e73686f74253230323031352d30392d303825323031302e35332e34372e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/1al1gdd8q2ku17o/Screenshot%202015-09-08%2010.53.47.png?dl=1" style="max-width:100%;"></a></p>
<p>Now let us try the same CURL command using “guest” user credentials from the terminal</p>
<p><code class=" prettyprinted"><span class="pln">curl </span><span class="pun">-</span><span class="pln">k </span><span class="pun">-</span><span class="pln">u guest</span><span class="pun">:</span><span class="pln">guest</span><span class="pun">-</span><span class="pln">password </span><span class="str">'https://127.0.0.1:8443/gateway/knox_sample/webhdfs/v1?op=LISTSTATUS'</span></code></p>
<p><a href="https://camo.githubusercontent.com/9c16a6cbe36d7e1e4cc285a87c1fbcaaae57516d/687474703a2f2f7777772e64726f70626f782e636f6d2f732f32766f646361346461777a316578352f53637265656e73686f74253230323031352d30392d303825323031302e35352e32392e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/9c16a6cbe36d7e1e4cc285a87c1fbcaaae57516d/687474703a2f2f7777772e64726f70626f782e636f6d2f732f32766f646361346461777a316578352f53637265656e73686f74253230323031352d30392d303825323031302e35352e32392e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/2vodca4dawz1ex5/Screenshot%202015-09-08%2010.55.29.png?dl=1" style="max-width:100%;"></a></p>
<pre class=" prettyprinted"><code class=" prettyprinted"><span class="pun"><span class="pun">{</span></span><span class="str"><span class="str">"FileStatuses"</span></span><span class="pun"><span class="pun">:{</span></span><span class="str"><span class="str">"FileStatus"</span></span><span class="pun"><span class="pun">:[{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16393</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hadoop"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439987528048</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"yarn"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"app-logs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"777"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16389</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439987809562</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"apps"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">17000</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439989173392</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"demo"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16398</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439987529660</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdp"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16394</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439987528532</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"mapred"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"mapred"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16396</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hadoop"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439987538099</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"mapred"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"mr-history"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"777"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16954</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439988741413</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"ranger"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16386</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1440165443820</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"tmp"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"777"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">},{</span></span><span class="str"><span class="str">"accessTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"blockSize"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"childrenNum"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">8</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"fileId"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">16387</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"group"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"length"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"modificationTime"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">1439988397561</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"owner"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"hdfs"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"pathSuffix"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"user"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"permission"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"755"</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"replication"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"storagePolicy"</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">,</span></span><span class="str"><span class="str">"type"</span></span><span class="pun"><span class="pun">:</span></span><span class="str"><span class="str">"DIRECTORY"</span></span><span class="pun"><span class="pun">}]}}</span></span></code></pre>
<p>We can check the auditing in the Ranger Policy Manager → Audit screen</p>
<p><a href="https://camo.githubusercontent.com/256486a37e3fb83350ddf1fe92f866006a385d83/687474703a2f2f7777772e64726f70626f782e636f6d2f732f626f3969376f356e76626c386776332f53637265656e73686f74253230323031352d30392d303825323031302e35362e34352e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/256486a37e3fb83350ddf1fe92f866006a385d83/687474703a2f2f7777772e64726f70626f782e636f6d2f732f626f3969376f356e76626c386776332f53637265656e73686f74253230323031352d30392d303825323031302e35362e34352e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/bo9i7o5nvbl8gv3/Screenshot%202015-09-08%2010.56.45.png?dl=1" style="max-width:100%;"></a></p>
<p>Ranger plugin for Knox intercepts any request made to Knox and enforces policies which are retrieved from the Ranger Administration Portal</p>
<p>You can configure the Knox policies in Ranger to restrict to a specific service (WebHDFS, WebHCAT etc) and to a specific user or a group and you can even bind user/group to an ip address</p>
<p><a href="https://camo.githubusercontent.com/f277a14a26b188846a79c90a6cf5eb762ff5cf82/687474703a2f2f7777772e64726f70626f782e636f6d2f732f656a646a68387a396b3365373535752f53637265656e73686f74253230323031352d30392d303825323031302e35392e34332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/f277a14a26b188846a79c90a6cf5eb762ff5cf82/687474703a2f2f7777772e64726f70626f782e636f6d2f732f656a646a68387a396b3365373535752f53637265656e73686f74253230323031352d30392d303825323031302e35392e34332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/ejdjh8z9k3e755u/Screenshot%202015-09-08%2010.59.43.png?dl=1" style="max-width:100%;"></a></p>
<h3><a id="user-content-hive-grantrevoke-permission-scenarios" class="anchor" href="#hive-grantrevoke-permission-scenarios" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hive grant/revoke permission scenarios</h3>
<p>Ranger can support import of grant/revoke policies set through command line or Hue for Hive. Ranger can store these policies centrally along with policies created in the &nbsp;administration portal and enforce it in Hive using its plugin.</p>
<p><a href="https://camo.githubusercontent.com/4ced6fe7fd6a73540e3ee50333cc8a654748e8c6/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7a6c317633736537726b6c623330682f53637265656e73686f74253230323031352d30392d303825323031312e30312e32332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/4ced6fe7fd6a73540e3ee50333cc8a654748e8c6/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7a6c317633736537726b6c623330682f53637265656e73686f74253230323031352d30392d303825323031312e30312e32332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/zl1v3se7rklb30h/Screenshot%202015-09-08%2011.01.23.png?dl=1" style="max-width:100%;"></a></p>
<p>As a first step, disable the global access policy for Hive in Ranger Administration Portal</p>
<p><a href="https://camo.githubusercontent.com/6271168e1e3cdf5d286a758568a3164143f33b53/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61336131656e7878733873306136782f53637265656e73686f74253230323031352d30392d303825323031312e30332e33302e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/6271168e1e3cdf5d286a758568a3164143f33b53/687474703a2f2f7777772e64726f70626f782e636f6d2f732f61336131656e7878733873306136782f53637265656e73686f74253230323031352d30392d303825323031312e30332e33302e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/a3a1enxxs8s0a6x/Screenshot%202015-09-08%2011.03.30.png?dl=1" style="max-width:100%;"></a></p>
<p>Let us try running a Grant operation using user Hive from the command line. Login into beeline tool using the following command</p>
<p><code class=" prettyprinted"><span class="pln">beeline </span><span class="pun">-</span><span class="pln">u </span><span class="str">"jdbc:hive2://sandbox.hortonworks.com:10000/default"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">n it1 </span><span class="pun">-</span><span class="pln">p it1</span><span class="pun">-</span><span class="pln">d org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">hive</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">.</span><span class="typ">HiveDriver</span></code></p>
<p><a href="https://camo.githubusercontent.com/18f15c783bc1b3872d13370db68d6ebf0500340c/687474703a2f2f7777772e64726f70626f782e636f6d2f732f36376d6d6869637a6f6235643538312f53637265656e73686f74253230323031352d30392d303825323031312e30352e34342e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/18f15c783bc1b3872d13370db68d6ebf0500340c/687474703a2f2f7777772e64726f70626f782e636f6d2f732f36376d6d6869637a6f6235643538312f53637265656e73686f74253230323031352d30392d303825323031312e30352e34342e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/67mmhiczob5d581/Screenshot%202015-09-08%2011.05.44.png?dl=1" style="max-width:100%;"></a></p>
<p>Then issue the <code class=" prettyprinted"><span class="pln">GRANT</span></code> command</p>
<p><code class=" prettyprinted"><span class="pln">grant </span><span class="kwd">select</span><span class="pun">,</span><span class="pln"> update on table xademo</span><span class="pun">.</span><span class="pln">customer_details to user network1</span><span class="pun">;</span></code></p>
<p>You should see the following error:</p>
<p><a href="https://camo.githubusercontent.com/665fd9e680e7fe75fb1f81f85d6e44a5b3fffd60/687474703a2f2f7777772e64726f70626f782e636f6d2f732f68797966766d7969623635796132772f53637265656e73686f74253230323031352d30392d303825323031312e30372e31342e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/665fd9e680e7fe75fb1f81f85d6e44a5b3fffd60/687474703a2f2f7777772e64726f70626f782e636f6d2f732f68797966766d7969623635796132772f53637265656e73686f74253230323031352d30392d303825323031312e30372e31342e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/hyyfvmyib65ya2w/Screenshot%202015-09-08%2011.07.14.png?dl=1" style="max-width:100%;"></a></p>
<p>Let us check the audit log in the Ranger Administration Portal → Audit</p>
<p><a href="https://camo.githubusercontent.com/4811fd9b8fabbd878863c1dc59616201a70bd54d/687474703a2f2f7777772e64726f70626f782e636f6d2f732f76336d7364626f646c6e72373536382f53637265656e73686f74253230323031352d30392d303825323031312e30382e35322e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/4811fd9b8fabbd878863c1dc59616201a70bd54d/687474703a2f2f7777772e64726f70626f782e636f6d2f732f76336d7364626f646c6e72373536382f53637265656e73686f74253230323031352d30392d303825323031312e30382e35322e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/v3msdbodlnr7568/Screenshot%202015-09-08%2011.08.52.png?dl=1" style="max-width:100%;"></a></p>
<p>You can see that access was denied for an admin operation for user it1.</p>
<p>We can create a policy in Ranger for user ‘it1’ to be an admin. Create a new policy from the Ranger Admin console and ensure the configuration matches the illustration below</p>
<p><a href="https://camo.githubusercontent.com/800bb7cde0414315b89daf9971f0fdf14a3ef9fc/687474703a2f2f7777772e64726f70626f782e636f6d2f732f623835666e773239746439727566622f53637265656e73686f74253230323031352d30392d303825323031322e35372e34382e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/800bb7cde0414315b89daf9971f0fdf14a3ef9fc/687474703a2f2f7777772e64726f70626f782e636f6d2f732f623835666e773239746439727566622f53637265656e73686f74253230323031352d30392d303825323031322e35372e34382e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/b85fnw29td9rufb/Screenshot%202015-09-08%2012.57.48.png?dl=1" style="max-width:100%;"></a></p>
<p>We can try the beeline command again, once the policy has been saved.</p>
<p><code class=" prettyprinted"><span class="pln">GRANT </span><span class="kwd">select</span><span class="pun">,</span><span class="pln"> update on table xademo</span><span class="pun">.</span><span class="pln">customer_details to user network1</span><span class="pun">;</span></code></p>
<p><a href="https://camo.githubusercontent.com/fb2626122c81810804225a5b2b3b878071708833/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3672397830386a776c3532647763632f53637265656e73686f74253230323031352d30392d303825323031332e30302e33352e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/fb2626122c81810804225a5b2b3b878071708833/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3672397830386a776c3532647763632f53637265656e73686f74253230323031352d30392d303825323031332e30302e33352e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/6r9x08jwl52dwcc/Screenshot%202015-09-08%2013.00.35.png?dl=1" style="max-width:100%;"></a></p>
<p>If the command goes through successfully, you will see the policy created/updated in Ranger Admin Portal → Policy Manager. It checks if there is an existing relevant policy to update, else it creates a new one.&nbsp;<br>
<a href="https://camo.githubusercontent.com/8343fdec8e36d2e4d21a66485a8653fa62268963/687474703a2f2f7777772e64726f70626f782e636f6d2f732f753069756c723863397a34617669612f53637265656e73686f74253230323031352d30392d303825323031332e30322e33332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/8343fdec8e36d2e4d21a66485a8653fa62268963/687474703a2f2f7777772e64726f70626f782e636f6d2f732f753069756c723863397a34617669612f53637265656e73686f74253230323031352d30392d303825323031332e30322e33332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/u0iulr8c9z4avia/Screenshot%202015-09-08%2013.02.33.png?dl=1" style="max-width:100%;"></a></p>
<p>What happened here?</p>
<p>Ranger plugin intercepts GRANT/REVOKE commands in Hive and creates corresponding policies in Admin portal. The plugin then uses these policies for enforcing Hive authorization (Hiveserver2)</p>
<p>Users can run further GRANT commands to update permissions and REVOKE commands to take away permissions.</p>
<h3><a id="user-content-hbase-grantrevoke-permission-scenarios" class="anchor" href="#hbase-grantrevoke-permission-scenarios" aria-hidden="true"><span class="octicon octicon-link"></span></a>HBase grant/revoke permission scenarios</h3>
<p>Ranger can support import of grant/revoke policies set through command line in Hbase. Similar to Hive, Ranger can store these policies as part of the Policy Manager and enforce it in Hbase using its plugin.</p>
<p>Before you go further, ensure HBase is running from Ambari – <a href="http://127.0.0.1:8080" class="ext-link" target="_blank">http://127.0.0.1:8080</a> (username and password are&nbsp;<code class=" prettyprinted"><span class="pln">admin</span></code>).</p>
<p>If it is not go to <code class=" prettyprinted"><span class="typ">Service</span><span class="pln"> </span><span class="typ">Actions</span></code> button on top right and <code class=" prettyprinted"><span class="typ">Start</span></code> the service</p>
<p><a href="https://camo.githubusercontent.com/330b60b326479fd6c9a2b5e716694f95c4b4c9a0/687474703a2f2f7777772e64726f70626f782e636f6d2f732f73696c3033797a6d63356d667739692f53637265656e73686f74253230323031352d30392d303825323031332e31302e33322e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/330b60b326479fd6c9a2b5e716694f95c4b4c9a0/687474703a2f2f7777772e64726f70626f782e636f6d2f732f73696c3033797a6d63356d667739692f53637265656e73686f74253230323031352d30392d303825323031332e31302e33322e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/sil03yzmc5mfw9i/Screenshot%202015-09-08%2013.10.32.png?dl=1" style="max-width:100%;"></a></p>
<p>As a first step, let us try running a Grant operation using user Hbase.</p>
<p>Disable the public access policy “HBase Global Allow” in Ranger Administration Portal – policy manager</p>
<p><a href="https://camo.githubusercontent.com/ca34b18c3ae07ccd9645ccb3e1ff6888a8d0affe/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3277656e74626a70787778386932782f53637265656e73686f74253230323031352d30392d303825323031332e31332e30382e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/ca34b18c3ae07ccd9645ccb3e1ff6888a8d0affe/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3277656e74626a70787778386932782f53637265656e73686f74253230323031352d30392d303825323031332e31332e30382e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/2wentbjpxwx8i2x/Screenshot%202015-09-08%2013.13.08.png?dl=1" style="max-width:100%;"></a></p>
<p>Login into HBase shell as ‘it1’ user</p>
<pre class=" prettyprinted"><code class=" prettyprinted"><span class="pln"><span class="pln">su </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> it1

</span></span><span class="pun"><span class="pun">[</span></span><span class="pln"><span class="pln">it1@sandbox </span></span><span class="pun"><span class="pun">~]</span></span><span class="pln"><span class="pln">$ hbase shell</span></span></code></pre>
<p><a href="https://camo.githubusercontent.com/af7311aa74e166830572b00851ea872ac103e8d9/687474703a2f2f7777772e64726f70626f782e636f6d2f732f747868757171396b696877676379332f53637265656e73686f74253230323031352d30392d303825323031332e31342e33332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/af7311aa74e166830572b00851ea872ac103e8d9/687474703a2f2f7777772e64726f70626f782e636f6d2f732f747868757171396b696877676379332f53637265656e73686f74253230323031352d30392d303825323031332e31342e33332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/txhuqq9kihwgcy3/Screenshot%202015-09-08%2013.14.33.png?dl=1" style="max-width:100%;"></a></p>
<p>Run a grant command to give “Read”, “Write”, “Create” access to user mktg1 in table ‘iemployee’</p>
<p><code class=" prettyprinted"><span class="pln">hbase</span><span class="pun">(</span><span class="pln">main</span><span class="pun">):</span><span class="lit">001</span><span class="pun">:</span><span class="lit">0</span><span class="pun">&gt;</span><span class="pln"> grant </span><span class="str">'mktg1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'RWC'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'iemployee'</span></code></p>
<p>you should get a Acess Denied as below:</p>
<p><a href="https://camo.githubusercontent.com/4218130e75a3d1f1a018098a2e1974fdcd236b42/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a6a6c686a31776468386a75716e6a2f53637265656e73686f74253230323031352d30392d303825323031342e31302e32312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/4218130e75a3d1f1a018098a2e1974fdcd236b42/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a6a6c686a31776468386a75716e6a2f53637265656e73686f74253230323031352d30392d303825323031342e31302e32312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/jjlhj1wdh8juqnj/Screenshot%202015-09-08%2014.10.21.png?dl=1" style="max-width:100%;"></a></p>
<p>Go to Ranger Administration Portal → Policy Manager and create a new policy to assign “admin” rights to user it1</p>
<p><a href="https://camo.githubusercontent.com/3fc600b1011fe8586e01cd2afdd0003706972323/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a306a37653866637a7965683133662f53637265656e73686f74253230323031352d30392d303825323031342e31332e34362e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/3fc600b1011fe8586e01cd2afdd0003706972323/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a306a37653866637a7965683133662f53637265656e73686f74253230323031352d30392d303825323031342e31332e34362e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/j0j7e8fczyeh13f/Screenshot%202015-09-08%2014.13.46.png?dl=1" style="max-width:100%;"></a></p>
<p>Save the policy and rerun the HBase command again</p>
<pre class=" prettyprinted"><code class=" prettyprinted"><span class="pln"><span class="pln">hbase</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">main</span></span><span class="pun"><span class="pun">):</span></span><span class="lit"><span class="lit">006</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> grant </span></span><span class="str"><span class="str">'mktg1'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'RWC'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'iemployee'</span></span><span class="pln"><span class="pln">

</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> row</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">s</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">in</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0.8670</span></span><span class="pln"><span class="pln"> seconds</span></span></code></pre>
<p><a href="https://camo.githubusercontent.com/6877b791b03c5f21320fbe54f0b6c55fca164144/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7a3864386234707567776a733863312f53637265656e73686f74253230323031352d30392d303825323031342e31342e32372e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/6877b791b03c5f21320fbe54f0b6c55fca164144/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7a3864386234707567776a733863312f53637265656e73686f74253230323031352d30392d303825323031342e31342e32372e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/z8d8b4pugwjs8c1/Screenshot%202015-09-08%2014.14.27.png?dl=1" style="max-width:100%;"></a></p>
<p>Check HBase policies in the Ranger Policy Administration portal. The grant permissions were added to an existing policy for table ‘iemployee’ that we created in previous step</p>
<p><a href="https://camo.githubusercontent.com/2b81758a79dc9589ebc29e1985b373daf3db18ff/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7776697973307464726865383779722f53637265656e73686f74253230323031352d30392d303825323031342e31352e34342e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/2b81758a79dc9589ebc29e1985b373daf3db18ff/687474703a2f2f7777772e64726f70626f782e636f6d2f732f7776697973307464726865383779722f53637265656e73686f74253230323031352d30392d303825323031342e31352e34342e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/wviys0tdrhe87yr/Screenshot%202015-09-08%2014.15.44.png?dl=1" style="max-width:100%;"></a></p>
<p>You can revoke the same permissions and the permissions will be removed from Ranger admin. Try this in the same HBase shell</p>
<pre class=" prettyprinted"><code class=" prettyprinted"><span class="pln"><span class="pln">hbase</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">main</span></span><span class="pun"><span class="pun">):</span></span><span class="lit"><span class="lit">007</span></span><span class="pun"><span class="pun">:</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> revoke </span></span><span class="str"><span class="str">'mktg1'</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'iemployee'</span></span><span class="pln"><span class="pln">

</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> row</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">s</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">in</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0.4330</span></span><span class="pln"><span class="pln"> seconds</span></span></code></pre>
<p>You can check the existing policy and see if it has been changed</p>
<p><a href="https://camo.githubusercontent.com/46fd0cf24d2d381f18d5cdd8c8bc3c57bfe08651/687474703a2f2f7777772e64726f70626f782e636f6d2f732f75397535366e3872613934713232302f53637265656e73686f74253230323031352d30392d303825323031342e31362e33342e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/46fd0cf24d2d381f18d5cdd8c8bc3c57bfe08651/687474703a2f2f7777772e64726f70626f782e636f6d2f732f75397535366e3872613934713232302f53637265656e73686f74253230323031352d30392d303825323031342e31362e33342e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/u9u56n8ra94q220/Screenshot%202015-09-08%2014.16.34.png?dl=1" style="max-width:100%;"></a></p>
<p>What happened here?</p>
<p>Ranger plugin intercepts GRANT/REVOKE commands in Hbase and creates corresponding policies in the Admin portal. The plugin then uses these policies for enforcing authorization</p>
<p>Users can run further GRANT commands to update permissions and REVOKE commands to take away permissions.</p>
<h3><a id="user-content-rest-apis-for-policy-administration" class="anchor" href="#rest-apis-for-policy-administration" aria-hidden="true"><span class="octicon octicon-link"></span></a>REST APIs for Policy Administration</h3>
<p>Ranger policies administration can be managed through REST APIs. Users can use the APIs to create or update policies, instead of going into the Administration Portal.</p>
<h4><a id="user-content-running-rest-apis-from-command-line" class="anchor" href="#running-rest-apis-from-command-line" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running REST APIs from command line</h4>
<p>From your local command line shell, run this CURL command. This API will create a policy with the name “hadoopdev-testing-policy2” within the HDFS repository “sandbox_hdfs”</p>
<pre class=" prettyprinted"><code class=" prettyprinted"><span class="pln"><span class="pln">curl </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">i </span></span><span class="pun"><span class="pun">--</span></span><span class="pln"><span class="pln">header </span></span><span class="str"><span class="str">"Accept:application/json"</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">H </span></span><span class="str"><span class="str">"Content-Type: application/json"</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">--</span></span><span class="pln"><span class="pln">user admin</span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln">admin </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">X POST http</span></span><span class="pun"><span class="pun">:</span></span><span class="com"><span class="com">//127.0.0.1:6080/service/public/api/policy -d '{ "policyName":"hadoopdev-testing-policy2","resourceName":"/demo/data/test","description":"Testing policy for /demo/data/test","repositoryName":"sandbox_hdfs","repositoryType":"HDFS","permMapList":[{"userList":["mktg1"],"permList":["Read"]},{"groupList":["IT"],"permList":["Read"]}],"isEnabled":true,"isRecursive":true,"isAuditEnabled":true,"version":"0.1.0","replacePerm":false}'</span></span></code></pre>
<p><a href="https://camo.githubusercontent.com/553b568581b4e5f904d426fd6b435bacd1615a6f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3862676a6c6d75323736326d3268702f53637265656e73686f74253230323031352d30392d303825323031342e31382e34332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/553b568581b4e5f904d426fd6b435bacd1615a6f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f3862676a6c6d75323736326d3268702f53637265656e73686f74253230323031352d30392d303825323031342e31382e34332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/8bgjlmu2762m2hp/Screenshot%202015-09-08%2014.18.43.png?dl=1" style="max-width:100%;"></a></p>
<p>the policy manager and see the new policy named “hadoopdev-testing-policy2”</p>
<p><a href="https://camo.githubusercontent.com/20d2232f84d424bc9eae69d762b1759c23700c1f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a6d6470656c6177766836343275352f53637265656e73686f74253230323031352d30392d303825323031342e32312e30372e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/20d2232f84d424bc9eae69d762b1759c23700c1f/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6a6d6470656c6177766836343275352f53637265656e73686f74253230323031352d30392d303825323031342e32312e30372e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/jmdpelawvh642u5/Screenshot%202015-09-08%2014.21.07.png?dl=1" style="max-width:100%;"></a></p>
<p>Click on the policy and check the permissions that has been created</p>
<p><a href="https://camo.githubusercontent.com/495454e10a22a51f615a34c899931817d9f885ff/687474703a2f2f7777772e64726f70626f782e636f6d2f732f773768346e317868307032706439782f53637265656e73686f74253230323031352d30392d303825323031342e32312e35312e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/495454e10a22a51f615a34c899931817d9f885ff/687474703a2f2f7777772e64726f70626f782e636f6d2f732f773768346e317868307032706439782f53637265656e73686f74253230323031352d30392d303825323031342e32312e35312e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/w7h4n1xh0p2pd9x/Screenshot%202015-09-08%2014.21.51.png?dl=1" style="max-width:100%;"></a></p>
<p>The policy id is part of the URL of this policy detail page<a href="http://127.0.0.1:6080/index.html#!/hdfs/1/policy/26" class="ext-link" target="_blank">http://127.0.0.1:6080/index.html#!/hdfs/1/policy/26</a></p>
<p>We can use the policy id to retrieve or change the policy.</p>
<p>Run the below CURL command to get policy details using API</p>
<p><code class=" prettyprinted"><span class="pln">curl </span><span class="pun">-</span><span class="pln">i </span><span class="pun">--</span><span class="pln">user admin</span><span class="pun">:</span><span class="pln">admin </span><span class="pun">-</span><span class="pln">X GET http</span><span class="pun">:</span><span class="com">//127.0.0.1:6080/service/public/api/policy/26</span></code></p>
<p><a href="https://camo.githubusercontent.com/be6e7355ed7ab4a5f1cd015dc5dc8059916dfb71/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6573336d66376e76676971726e69732f53637265656e73686f74253230323031352d30392d303825323031342e32342e32332e706e673f646c3d31" target="_blank"><img src="https://camo.githubusercontent.com/be6e7355ed7ab4a5f1cd015dc5dc8059916dfb71/687474703a2f2f7777772e64726f70626f782e636f6d2f732f6573336d66376e76676971726e69732f53637265656e73686f74253230323031352d30392d303825323031342e32342e32332e706e673f646c3d31" alt="" data-canonical-src="http://www.dropbox.com/s/es3mf7nvgiqrnis/Screenshot%202015-09-08%2014.24.23.png?dl=1" style="max-width:100%;"></a></p>
<p>What happened here?</p>
<p>We created a policy and retrieved policy details using REST APIs. Users can now manage their policies using API tools or applications integrated with the Ranger REST APIs</p>
<p>Hopefully, through this whirlwind tour of Ranger, you were introduced to the simplicity and power of Ranger for security administration.</p>
