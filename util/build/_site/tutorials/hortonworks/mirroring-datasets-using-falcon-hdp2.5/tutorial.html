

<div class="tutorial-content">
  <h2 id="introduction">Introduction</h2>

<p>Apache Falcon is a framework to simplify data pipeline processing and management on Hadoop clusters.</p>

<p>It provides data management services such as retention, replications across clusters, archival etc. It makes it much simpler to onboard new workflows/pipelines, with support for late data handling and retry policies. It allows you to easily define relationship between various data and processing elements and integrate with metastore/catalog such as Hive/HCatalog. Finally it also lets you capture lineage information for feeds and processes.</p>

<p>In this tutorial we are going walk the process of mirroring the datasets between Hadoop clusters.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="http://hortonworks.com/downloads/#sandbox">Download Hortonworks Sandbox 2.5</a></li>
  <li>Complete the <a href="http://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/">Learning the Ropes of the Hortonworks Sandbox tutorial,</a> you will need it for logging into Ambari as an administrator user.</li>
  <li>Complete the <a href="https://github.com/hortonworks/tutorials-future/blob/master/tutorials/hortonworks/create-falcon-cluster-hdp2.5/tutorial.md">Leveraging Apache Falcon with Your Hadoop Clusters</a> tutorial to start the falcon service, prepare HDFS directories for Falcon cluster and to create Falcon cluster entities.</li>
</ul>

<h2 id="outline">Outline</h2>
<ul>
  <li><a href="#create-ambari-qa-user">1: Create ambari-qa user</a></li>
  <li><a href="#preparing-hdfs-directories">2: Preparing HDFS Directories</a></li>
  <li><a href="#setting-up-mirroring-job">3: Setting up the Mirroring Job</a></li>
  <li><a href="#running-job">4: Running the Job</a></li>
  <li><a href="#summary">5: Summary</a></li>
</ul>

<h2 id="1-create-ambari-qa-user-">1. Create ambari-qa user <a id="create-ambari-qa-user"></a></h2>

<p>After creating cluster entities, let us go back to Ambari as <code class="highlighter-rouge">admin</code> user. Click on admin menu drop down and then <code class="highlighter-rouge">Manage Ambari</code>:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/manage_ambari.png" alt="manage_ambari" /></p>

<p>Click the blue <code class="highlighter-rouge">Users</code> button in the bottom box as given below:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/manage_users.png" alt="manage_users" /></p>

<p>Click the <code class="highlighter-rouge">Create Local User</code> button at the top of the page. Enter <code class="highlighter-rouge">ambari-qa</code> as the user name and then set the password for it. Enter it again for confirmation and <code class="highlighter-rouge">Save</code> the user.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/save_local_user.png" alt="save_local_user" /></p>

<p>You can see the newly added <code class="highlighter-rouge">ambari-qa</code> user. Click on it to assign it a group so that it can access Ambari views.
Write <code class="highlighter-rouge">"views"</code> and select it in <code class="highlighter-rouge">Local Group Membership</code>  box and then click on <code class="highlighter-rouge">tick</code> mark to add an <code class="highlighter-rouge">ambari-qa</code> user in the <code class="highlighter-rouge">"views"</code> group.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/local_group_permission.png" alt="local_group_permission" /></p>

<p>Now logout of Ambari from the <code class="highlighter-rouge">admin</code> user and login to Ambari as <code class="highlighter-rouge">ambari-qa</code> user.</p>

<h2 id="2-preparing-hdfs-directories-">2. Preparing HDFS Directories <a id="preparing-hdfs-directories"></a></h2>

<p>Select the Files View and you can view the following default folders:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/files_view_home_page.png" alt="files_view_home_page" /></p>

<p>Navigate to <code class="highlighter-rouge">/user/ambari-qa</code> and create a new directory <code class="highlighter-rouge">falcon</code>
Click on the row of <code class="highlighter-rouge">falcon</code> directory and then click on <code class="highlighter-rouge">Permissions</code> button:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/click_permissions.png" alt="click_permissions" /></p>

<p>Add <code class="highlighter-rouge">Write</code> permission for both Group and Others and then click <code class="highlighter-rouge">Save</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/edit_permissions.png" alt="edit_permissions" /></p>

<p>Now create the directories <code class="highlighter-rouge">mirrorSrc</code> and <code class="highlighter-rouge">mirrorTgt</code> under <code class="highlighter-rouge">/user/ambari-qa/falcon</code> as the source and target of the mirroring job we are about to create.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror_src_tgt_created.png" alt="mirror_src_tgt_created" />
&lt;!—
After creating cluster entities, let's go back to the SSH terminal, switch the user to <code class="highlighter-rouge">root</code> and then to <code class="highlighter-rouge">ambari-qa</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hadoop fs -mkdir /user/ambari-qa/falcon
hadoop fs -mkdir /user/ambari-qa/falcon/mirrorSrc
hadoop fs -mkdir /user/ambari-qa/falcon/mirrorTgt
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/creatingMirrorDirectories.png" alt="creatingMirrorDirectories" /></p>

<p>Now we need to set permissions to allow access. You must be logged in as the owner of the directory <code class="highlighter-rouge">/user/ambari-qa/falcon/</code></p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>hadoop fs -chmod -R 777 /user/ambari-qa/falcon
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/givingPermission.png" alt="givingPermission" /></p>

<p>–&gt;</p>

<h2 id="3-setting-up-the-mirroring-job-">3. Setting up the Mirroring Job <a id="setting-up-mirroring-job"></a></h2>

<p>To create the mirroring job, go back to the Falcon UI on your browser and click on the <code class="highlighter-rouge">Create</code> drop down.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/select_mirror.png" alt="select_mirror" /></p>

<p>Click <code class="highlighter-rouge">Mirror</code> from the drop down menu, you will see a page like this:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror_home_page.png" alt="mirror_home_page" /></p>

<p>Provide a name of your choice. The name must be unique to the system. We named the Mirror Job <code class="highlighter-rouge">MirrorTest</code>.</p>

<p>Ensure the File System mirror type is selected, then select the appropriate Source and Target and type in the appropriate paths. In our case the source cluster is <code class="highlighter-rouge">primaryCluster</code> and that HDFS path on the cluster is <code class="highlighter-rouge">/user/ambari-qa/falcon/mirrorSrc</code>.</p>

<p>The target cluster is <code class="highlighter-rouge">backupCluster</code> and that HDFS path on the cluster is <code class="highlighter-rouge">/user/ambari-qa/falcon/mirrorTgt</code>.
Also set the validity of the job to your current time, so that when you attempt to run the job in a few minutes, the job is still within the validity period. Keep default values in Advanced Options and then Click <code class="highlighter-rouge">Next</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror1.png" alt="mirror1" /></p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror2.png" alt="mirror2" /></p>

<p>Verify the summary information, then click <code class="highlighter-rouge">Save</code>:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror_summary1.png" alt="mirror_summary1" /></p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/mirror_summary2.png" alt="mirror_summary2" /></p>

<h2 id="4-running-the-job-">4. Running the Job <a id="running-job"></a></h2>

<p>Before we can run the job, we need some data to test on HDFS. 
&lt;!—Let's give us permission to upload some data using the HDFS View in Ambari.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>su - root

su hdfs

hadoop fs -chmod -R 775 /user/ambari-qa
</code></pre>
</div>

<p>Open Ambari from your browser at port 8080.
Then launch the HDFS view from the top right hand corner.
–&gt;
Keep login as ambari-qa and from the view on the Ambari console navigate to the directory <code class="highlighter-rouge">/user/ambari-qa/falcon/mirrorSrc</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/hdfs_directory_filesview.png" alt="hdfs_directory_filesview" /></p>

<p>Click <code class="highlighter-rouge">Upload</code> button and upload any file you want to use.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/local_file_path.png" alt="local_file_path" /></p>

<p>Once uploaded the file should appear in the directory.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/local_file_uploaded.png" alt="local_file_uploaded" /></p>

<p>Now navigate to the Falcon UI and search for the job we created. The name of the Mirror job we had created was <code class="highlighter-rouge">MirrorTest</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/search_mirror_test.png" alt="search_mirror_test" /></p>

<p>Select the <code class="highlighter-rouge">MirrorTest</code> job by clicking the checkbox and then click on <code class="highlighter-rouge">Schedule</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/schedule_mirror_test.png" alt="schedule_mirror_test" /></p>

<p>The state of the job should change from <code class="highlighter-rouge">SUBMITTED</code> to <code class="highlighter-rouge">RUNNING</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/running_mirror_test.png" alt="running_mirror_test" /></p>

<p>After a few minutes, use the HDFS View in the Ambari console to check the <code class="highlighter-rouge">/user/ambari-qa/falcon/mirrorTgt</code> directory and you should see that  your data is mirrored.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp-2.5/assets/mirroring-datasets-using-falcon-hdp2.5/test_file_copied.png" alt="test_file_copied" /></p>

<h2 id="4-summary-">4. Summary <a id="summary"></a></h2>

<p>In this tutorial we walked through the process of mirroring the datasets between two cluster entities.</p>

</div>

<div id="tutorial-footer">
  <hr>
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>
  <p>If you need help or have questions with this tutorial, please first check HCC for existing Answers to questions on this tutorial using the Find Answers button.  If you don't find your answer you can post a new HCC question for this tutorial using the Ask Questions button.</p>
  <p><a class="btn" href="https://community.hortonworks.com/topics/tutorial-680.html" role="button">Find Answers</a> <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-680&topics=hdp-2.5.0" role="button">Ask Questions</a></p>
  <p>Tutorial Name: <strong>Mirroring Datasets Between Hadoop Clusters with Apache Falcon</strong></p>
  <p>HCC Tutorial Tag:<strong> tutorial-680</strong> and <strong>hdp-2.5.0</strong></p>
  <p>If the tutorial has multiple labs please indicate which lab your question corresponds to. Please provide any feedback related to that lab.</p>
  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks github and can be contributed via the <a href="https://github.com/hortonworks/tutorials/wiki">Hortonworks Tutorial Contribution Guide</a>.  If you are certain there is an issue or bug with the tutorial, please <a href="https://github.com/hortonworks/tutorials/wiki#issues-with-tutorials">create an issue</a> on the repository and we will do our best to resolve it!</p>
</div>
