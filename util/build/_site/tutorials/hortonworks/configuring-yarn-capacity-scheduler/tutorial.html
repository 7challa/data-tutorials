

<div class="tutorial-content">
  <p>In this tutorial we are going to explore how we can configure YARN CapacityScheduler from Ambari.</p>

<h3 id="what-is-the-yarns-capacityscheduler">What is the YARN's CapacityScheduler?</h3>

<p>YARN's CapacityScheduler is designed to run Hadoop applications in a shared, multi-tenant cluster while maximizing the throughput and the utilization of the cluster.</p>

<p>Traditionally each organization has it own private set of compute resources that have sufficient capacity to meet the organization's SLA. This generally leads to poor average utilization. Also there is heavy overhead of managing multiple independent clusters.</p>

<p>Sharing clusters between organizations allows economies of scale . However, organizations are concerned about sharing a cluster in the fear of not getting enaough available resources that are critical to meet their SLAs.</p>

<p>The CapacityScheduler is designed to allow sharing a large cluster while giving each organization capacity guarantees. There is an added benefit that an organization can access any excess capacity not being used by others. This provides elasticity for the organizations in a cost-effective manner.</p>

<p>Sharing clusters across organizations necessitates strong support for multi-tenancy since each organization must be guaranteed capacity and safe-guards to ensure the shared cluster is impervious to single rogue application or user or sets thereof. The CapacityScheduler provides a stringent set of limits to ensure that a single application or user or queue cannot consume disproportionate amount of resources in the cluster. Also, the CapacityScheduler provides limits on initialized/pending applications from a single user and queue to ensure fairness and stability of the cluster.</p>

<p>The primary abstraction provided by the CapacityScheduler is the concept of queues. These queues are typically setup by administrators to reflect the economics of the shared cluster.</p>

<p>To provide further control and predictability on sharing of resources, the CapacityScheduler supports hierarchical queues to ensure resources are shared among the sub-queues of an organization before other queues are allowed to use free resources, there-by providing affinity for sharing free resources among applications of a given organization.</p>

<h3 id="configuring-the-capacity-scheduler">Configuring the Capacity Scheduler</h3>

<p>For rest of the tutorial we will use the Ambari hosted on the <a href="http://hortonworks.com/sandbox">Hortonworks Sandbox</a>.</p>

<p>After you spin up the Hortonworks Sandbox, login to Ambari. The default username and password is <code class="highlighter-rouge">admin</code> /<code class="highlighter-rouge">admin</code>.<br />
<img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari001.png" alt="" /></p>

<p>After you Login, you will see the Dashboard. This is an unified view of the state of your cluster.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari002.png" alt="" /></p>

<p>You can drill into specify service dashboard and configuration.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari003.png" alt="" /></p>

<p>Let's dive into YARN dashboard by selecting Yarn from the left-side bar or the drop down menu.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari004.png" alt="" /></p>

<p>We will start updating the configuration for Yarn Capacity Scheduling policies.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari005.png" alt="" /></p>

<p>Scroll down to the <code class="highlighter-rouge">Scheduler</code> section of the page. The default capacity scheduling policy just has one queue.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari006.png" alt="" /></p>

<p>Let check out the scheduling policy visually. Scroll up to the top of the page and click on quick links. Then select ResourceManager UI from the dropdown.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari007.png" alt="" /></p>

<p>As you can see below we just have the default policy.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari008.png" alt="" /></p>

<p>Let's change the capacity scheduling policy to where we have seperate queues and policies for Engineering, Marketing and Support departments:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yarn.scheduler.capacity.maximum-am-resource-percent=0.2
yarn.scheduler.capacity.maximum-applications=10000
yarn.scheduler.capacity.node-locality-delay=40
yarn.scheduler.capacity.root.Engineering.Development.acl_administer_jobs=*
yarn.scheduler.capacity.root.Engineering.Development.acl_administer_queue=*
yarn.scheduler.capacity.root.Engineering.Development.acl_submit_applications=*
yarn.scheduler.capacity.root.Engineering.Development.capacity=20
yarn.scheduler.capacity.root.Engineering.Development.minimumaximum-capacity=100
yarn.scheduler.capacity.root.Engineering.Development.state=RUNNING
yarn.scheduler.capacity.root.Engineering.Development.user-limit-factor=1
yarn.scheduler.capacity.root.Engineering.QE.acl_administer_jobs=*
yarn.scheduler.capacity.root.Engineering.QE.acl_administer_queue=*
yarn.scheduler.capacity.root.Engineering.QE.acl_submit_applications=*
yarn.scheduler.capacity.root.Engineering.QE.capacity=80
yarn.scheduler.capacity.root.Engineering.QE.maximum-capacity=90
yarn.scheduler.capacity.root.Engineering.QE.state=RUNNING
yarn.scheduler.capacity.root.Engineering.QE.user-limit-factor=1
yarn.scheduler.capacity.root.Engineering.acl_administer_jobs=*
yarn.scheduler.capacity.root.Engineering.acl_administer_queue=*
yarn.scheduler.capacity.root.Engineering.acl_submit_applications=*
yarn.scheduler.capacity.root.Engineering.capacity=60
yarn.scheduler.capacity.root.Engineering.maximum-capacity=100
yarn.scheduler.capacity.root.Engineering.queues=Development,QE
yarn.scheduler.capacity.root.Engineering.state=RUNNING
yarn.scheduler.capacity.root.Engineering.user-limit-factor=1
yarn.scheduler.capacity.root.Marketing.Advertising.acl_administer_jobs=*
yarn.scheduler.capacity.root.Marketing.Advertising.acl_administer_queue=*
yarn.scheduler.capacity.root.Marketing.Advertising.acl_submit_applications=*
yarn.scheduler.capacity.root.Marketing.Advertising.capacity=30
yarn.scheduler.capacity.root.Marketing.Advertising.maximum-capacity=40
yarn.scheduler.capacity.root.Marketing.Advertising.state=STOPPED
yarn.scheduler.capacity.root.Marketing.Advertising.user-limit-factor=1
yarn.scheduler.capacity.root.Marketing.Sales.acl_administer_jobs=*
yarn.scheduler.capacity.root.Marketing.Sales.acl_administer_queue=*
yarn.scheduler.capacity.root.Marketing.Sales.acl_submit_applications=*
yarn.scheduler.capacity.root.Marketing.Sales.capacity=70
yarn.scheduler.capacity.root.Marketing.Sales.maximum-capacity=80
yarn.scheduler.capacity.root.Marketing.Sales.minimum-user-limit-percent=20
yarn.scheduler.capacity.root.Marketing.Sales.state=RUNNING
yarn.scheduler.capacity.root.Marketing.Sales.user-limit-factor=1
yarn.scheduler.capacity.root.Marketing.acl_administer_jobs=*
yarn.scheduler.capacity.root.Marketing.acl_submit_applications=*
yarn.scheduler.capacity.root.Marketing.capacity=10
yarn.scheduler.capacity.root.Marketing.maximum-capacity=40
yarn.scheduler.capacity.root.Marketing.queues=Sales,Advertising
yarn.scheduler.capacity.root.Marketing.state=RUNNING
yarn.scheduler.capacity.root.Marketing.user-limit-factor=1
yarn.scheduler.capacity.root.Support.Services.acl_administer_jobs=*
yarn.scheduler.capacity.root.Support.Services.acl_administer_queue=*
yarn.scheduler.capacity.root.Support.Services.acl_submit_applications=*
yarn.scheduler.capacity.root.Support.Services.capacity=80
yarn.scheduler.capacity.root.Support.Services.maximum-capacity=100
yarn.scheduler.capacity.root.Support.Services.minimum-user-limit-percent=20
yarn.scheduler.capacity.root.Support.Services.state=RUNNING
yarn.scheduler.capacity.root.Support.Services.user-limit-factor=1
yarn.scheduler.capacity.root.Support.Training.acl_administer_jobs=*
yarn.scheduler.capacity.root.Support.Training.acl_administer_queue=*
yarn.scheduler.capacity.root.Support.Training.acl_submit_applications=*
yarn.scheduler.capacity.root.Support.Training.capacity=20
yarn.scheduler.capacity.root.Support.Training.maximum-capacity=60
yarn.scheduler.capacity.root.Support.Training.state=RUNNING
yarn.scheduler.capacity.root.Support.Training.user-limit-factor=1
yarn.scheduler.capacity.root.Support.acl_administer_jobs=*
yarn.scheduler.capacity.root.Support.acl_administer_queue=*
yarn.scheduler.capacity.root.Support.acl_submit_applications=*
yarn.scheduler.capacity.root.Support.capacity=30
yarn.scheduler.capacity.root.Support.maximum-capacity=100
yarn.scheduler.capacity.root.Support.queues=Training,Services
yarn.scheduler.capacity.root.Support.state=RUNNING
yarn.scheduler.capacity.root.Support.user-limit-factor=1
yarn.scheduler.capacity.root.acl_administer_queue=*
yarn.scheduler.capacity.root.capacity=100
yarn.scheduler.capacity.root.queues=Support,Marketing,Engineering
yarn.scheduler.capacity.root.unfunded.capacity=50
</code></pre>
</div>

<p>Copy and paste the above policy in the <code class="highlighter-rouge">Capacity  Scheduler</code> textbox:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari006.png" alt="" /></p>

<p>Click <code class="highlighter-rouge">Save</code> and confirm on the dialog box:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari009.png" alt="" /></p>

<p>At this point the, the configuration is saved but we still need to restart the affected components by the configuration change as indicated in the orange band below:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari010.png" alt="" /></p>

<p>Also note that there is now a new version of the configuration as indicated by the green <code class="highlighter-rouge">Current</code> label. Let's restart the daemons by clicking <code class="highlighter-rouge">Restart  All</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari011.png" alt="" /></p>

<p>Wait for the restart to complete:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari013.png" alt="" /></p>

<p>and then goto the browser tab with the Capacity Scheduler policy and refresh the page. Voila! There's our new policy:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/configuring-yarn-capacity-scheduler/ambari015.png" alt="" /></p>

<p>Hope this brief tour of using YARN's CapacityScheduler gave you some ideas on howto achieve better utilization of Hadoop clusters.</p>

</div>

<div id="tutorial-footer">
  <hr>
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>
  <p>If you need help or have questions with this tutorial, please first check HCC for existing Answers to questions on this tutorial using the Find Answers button.  If you don't find your answer you can post a new HCC question for this tutorial using the Ask Questions button.</p>
  <p><a class="btn" href="https://community.hortonworks.com/topics/tutorial-440.html" role="button">Find Answers</a> <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-440&topics=hdp-2.4.0" role="button">Ask Questions</a></p>
  <p>Tutorial Name: <strong>Configuring YARN Capacity Scheduler with Ambari</strong></p>
  <p>HCC Tutorial Tag:<strong> tutorial-440</strong> and <strong>hdp-2.4.0</strong></p>
  <p>If the tutorial has multiple labs please indicate which lab your question corresponds to. Please provide any feedback related to that lab.</p>
  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks github and can be contributed via the <a href="https://github.com/hortonworks/tutorials/wiki">Hortonworks Tutorial Contribution Guide</a>.  If you are certain there is an issue or bug with the tutorial, please <a href="https://github.com/hortonworks/tutorials/wiki#issues-with-tutorials">create an issue</a> on the repository and we will do our best to resolve it!</p>
</div>
