

<div class="tutorial-content">
  <h1 id="how-to-load-data-into-the-hortonworks-sandbox">How to Load Data Into the Hortonworks Sandbox</h1>

<h3 id="introduction">Introduction</h3>

<p>The Hortonworks Sandbox is a fully contained Hortonworks Data Platform (HDP) environment. The sandbox includes the core Hadoop components, as well as all the tools needed for data ingestion and processing. You can access and analyze sandbox data with many Business Intelligence (BI) applications.</p>

<p>In this tutorial, we will load and review data for a fictitious web retail store in what has become an established use case for Hadoop: deriving insights from large data sources such as web logs. By combining web logs with more traditional customer data, we can better understand our customers, and also understand how to optimize future promotions and advertising.</p>

<h2 id="pre-requisites">Pre-Requisites</h2>
<ul>
  <li>Downloaded and Installed latest <a href="http://hortonworks.com/products/hortonworks-sandbox/#install">Hortonworks Sandbox</a></li>
  <li><a href="http://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/">Learning the Ropes of the Hortonworks Sandbox</a></li>
  <li>Allow yourself around one hour to complete this tutorial</li>
</ul>

<h2 id="outline">Outline</h2>

<p>To load data into the Hortonworks sandbox, you will:</p>

<ul>
  <li><a href="#download-sample-data">Step 1: Download the sample data</a></li>
  <li><a href="#upload-the-data-files-into-the-sandbox">Step 2: Upload the Data Files into the Sandbox</a></li>
  <li><a href="#create-hive-tables">Step 3: Create Hive Tables</a></li>
  <li><a href="#load-data-into-new-tables">Step 4: Load data into new tables</a></li>
  <li><a href="#view-and-refine-the-data-in-the-sandbox">Step 5: View and Refine the Data in the Sandbox</a></li>
  <li><a href="#further-resources">Further Resources</a></li>
</ul>

<h3 id="step-1-download-the-sample-data-a-iddownload-sample-dataa">Step 1: Download the Sample Data <a id="download-sample-data"></a></h3>

<p>You can download a set of sample data contained in a compressed (.zip) folder here:</p>

<p><a href="https://s3.amazonaws.com/hw-sandbox/tutorial8/RefineDemoData.zip">RefineDemoData.zip</a></p>

<p>Save the sample data .zip file to your computer, then extract the files and unzip Omniture.0.tsv.gz, users.tsv.gz and products.tsv.gz.</p>

<p><strong>Note</strong>: The extracted data files should have a .tsv file extension at the end.</p>

<h3 id="step-2-upload-the-data-files-into-the-sandbox-a-idupload-the-data-files-into-the-sandboxa">Step 2: Upload the Data Files into the Sandbox <a id="upload-the-data-files-into-the-sandbox"></a></h3>

<p>2.1) Select the <code class="highlighter-rouge">HDFS Files view</code> from the Off-canvas menu at the top. The HDFS Files view allows you to view the Hortonworks Data Platform(HDP) file store. The HDP file system is separate from the local file system.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/hello-hdp/hdfs_files_view_hello_hdp_lab1.png" alt="" /></p>

<p>2.2) Navigate to <code class="highlighter-rouge">/tmp</code>, create an <strong>maria_dev</strong> folder</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/tmp_maria_dev_folder_load_data_sandbox.png" alt="" /></p>

<p>2.3) right click on <strong>maria_dev</strong> and select <strong>Permissions</strong>:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/permissions_maria_dev_folder_load_data_sandbox.png" alt="" /></p>

<p>2.4) Now we check the <code class="highlighter-rouge">Write buttons</code> and <code class="highlighter-rouge">modify recursively</code> and press save.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/write_buttons_modify_recursive_load_data_sandbox.png" alt="" /></p>

<p>2.5) Verify that the permissions look now like the image below:</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/verify_permissions_load_data_sandbox.png" alt="" /></p>

<p>2.6) Now, we navigate to <code class="highlighter-rouge">/tmp/maria_dev</code>, click on upload and browse the <code class="highlighter-rouge">Omniture.0.tsv</code>.</p>

<p>Repeat this procedure for <code class="highlighter-rouge">users.tsv</code> file and for <code class="highlighter-rouge">products.tsv</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/upload_refine_demo_data_load_data_sandbox.png" alt="" /></p>

<h3 id="step-3-create-hive-tables-a-idcreate-hive-tablesa">Step 3: Create Hive tables <a id="create-hive-tables"></a></h3>

<p>3.1) Let's open the <code class="highlighter-rouge">Hive  View</code> by clicking on the Hive button from the <code class="highlighter-rouge">views menu</code>.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/hive_view_icon_load_data_sandbox.png" alt="" /></p>

<p>3.2) Create the tables users, products and omniturelogs.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>create table users (swid STRING, birth_dt STRING, gender_cd CHAR(1)) ROW FORMAT DELIMITED
FIELDS TERMINATED by '\t' stored as textfile 
tblproperties ("skip.header.line.count"="1");
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/create_table_users_load_data_sandbox.png" alt="" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>create table products (url STRING, category STRING) ROW FORMAT DELIMITED
FIELDS TERMINATED by '\t' stored as textfile 
tblproperties ("skip.header.line.count"="1");
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/create_table_products_load_data_sandbox.png" alt="" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>create table omniturelogs (col_1 STRING,col_2 STRING,col_3 STRING,col_4 STRING,col_5 STRING,col_6 STRING,col_7 STRING,col_8 STRING,col_9 STRING,col_10 STRING,col_11 STRING,col_12 STRING,col_13 STRING,col_14 STRING,col_15 STRING,col_16 STRING,col_17 STRING,col_18 STRING,col_19 STRING,col_20 STRING,col_21 STRING,col_22 STRING,col_23 STRING,col_24 STRING,col_25 STRING,col_26 STRING,col_27 STRING,col_28 STRING,col_29 STRING,col_30 STRING,col_31 STRING,col_32 STRING,col_33 STRING,col_34 STRING,col_35 STRING,col_36 STRING,col_37 STRING,col_38 STRING,col_39 STRING,col_40 STRING,col_41 STRING,col_42 STRING,col_43 STRING,col_44 STRING,col_45 STRING,col_46 STRING,col_47 STRING,col_48 STRING,col_49 STRING,col_50 STRING,col_51 STRING,col_52 STRING,col_53 STRING) 
ROW FORMAT DELIMITED
FIELDS TERMINATED by '\t' stored as textfile 
tblproperties ("skip.header.line.count"="1");
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/create_table_omniturelogs_load_data_sandbox.png" alt="" /></p>

<h3 id="step-4-load-data-into-new-tables-a-idload-data-into-new-tablesa">Step 4: Load data into new tables <a id="load-data-into-new-tables"></a></h3>

<p>4.1) To load the data into the tables, we have to execute the following queries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>LOAD DATA INPATH '/tmp/maria_dev/products.tsv' OVERWRITE INTO TABLE products; 
LOAD DATA INPATH '/tmp/maria_dev/users.tsv' OVERWRITE INTO TABLE users; 
LOAD DATA INPATH '/tmp/maria_dev/Omniture.0.tsv' OVERWRITE INTO TABLE omniturelogs;
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/load_demo_data_load_data_sandbox.png" alt="" /></p>

<p>4.2) To check if the data was loaded, click on the icon next to the table name. It executes a sample query.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/users_sample_data_load_data_sandbox.png" alt="" /><br />
<img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/products_sample_data_load_data_sandbox.png" alt="" /><br />
<img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/omniturelogs_sample_data_load_data_sandbox.png" alt="" /></p>

<h3 id="step-5-view-and-refine-the-data-in-the-sandbox-a-idview-and-refine-the-data-in-the-sandboxa">Step 5: View and Refine the Data in the Sandbox <a id="view-and-refine-the-data-in-the-sandbox"></a></h3>

<p>In the previous section, we created sandbox tables from uploaded data files. Now let's take a closer look at that data.</p>

<p>Here's a summary of the data we're working with:</p>

<p><strong>omniturelogs</strong> – website logs containing information such as URL, timestamp, IP address, geocoded IP, and session ID.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/ominturelog_file_firsthalf_load_data_sandbox.png" alt="" /><br />
<img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/omniturelog_file_secondhalf_load_data_sandbox.png" alt="" /></p>

<p><strong>users</strong> – CRM user data listing SWIDs (Software User IDs) along with date of birth and gender.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/users_file_load_data_sandbox.png" alt="" /></p>

<p><strong>products</strong> – CMS data that maps product categories to website URLs.
&gt; <strong>Note:</strong> your products image should look similar to users image above.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/products_data_file_load_data_sandbox.png" alt="" /></p>

<p>5.1) Now let's use a Hive script to generate an "omniture" view that contains a subset of the data in the Omniture log table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CREATE VIEW omniture AS  
SELECT col_2 ts, col_8 ip, col_13 url, col_14 swid, col_50 city, col_51 country, col_53 state 
FROM omniturelogs
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/generate_omniture_subset_data_load_data_sandbox.png" alt="" /></p>

<p>5.2) Click Save as. On the "Saving item" pop-up, type "omniture" in the box, then click OK.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/save_as_omniture_load_data_sandbox.png" alt="" /></p>

<p>5.3) You can see your saved query now by clicking on the "Save Queries" button at the top.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/saved_query_save_queries_tab_load_data_sandbox.png" alt="" /></p>

<p>5.4) Click Execute to run the script.</p>

<p>To view the data generated by the saved script, click on the icon next to the view's name at the Database Explorer.<br />
The query results will appear, and you can see that the results include the data from the omniturelogs table that were specified in the query.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/omniture_sample_data_load_data_sandbox.png" alt="" /></p>

<p>5.5) Finally, we'll create a script that joins the omniture website log data to the CRM data (registered users) and CMS data (products). Click Query Editor, then paste the following text in the Query box:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>create table webloganalytics 
as select to_date(o.ts) logdate, o.url, o.ip, o.city, upper(o.state) state, o.country, p.category, CAST(datediff( from_unixtime( unix_timestamp() ), from_unixtime( unix_timestamp(u.birth_dt, 'dd-MMM-yy'))) / 365 AS INT) age,  u.gender_cd from omniture o inner join products p on o.url = p.url left outer join users u on o.swid = concat('{', u.swid , '}');
</code></pre>
</div>

<p>5.6) Save this script as "webloganalytics" and execute the script.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/create_table_join_omniturelogs_crm_cms_load_data_sandbox.png" alt="" /></p>

<p>You can view the data generated by the script as described in the preceding steps.</p>

<p><img src="https://raw.githubusercontent.com/hortonworks/tutorials/hdp/assets/how-to-load-data-into-sandbox/view_webloganalytics_data_load_data_sandbox.png" alt="" /></p>

<p>Now that you have loaded data into the Hortonworks Platform, you can use Business Intelligence (BI) applications such as Microsoft Excel to access and analyze the data.</p>

<h2 id="further-resources-a-idfurther-resourcesa">Further Resources <a id="further-resources"></a></h2>
<ul>
  <li><a href="http://hortonworks.com/hadoop/hive/">Apache Hive</a></li>
  <li><a href="http://hortonworks.com/hadoop/hive/#tutorials">Hive Tutorials</a></li>
  <li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL">Hive Language Manual</a></li>
  <li><a href="http://hortonworks.com/training/class/hadoop-2-data-analysis-pig-hive/">HDP Developer: Apache Pig and Hive</a></li>
</ul>

</div>

<div id="tutorial-footer">
  <hr>
  <h2>Tutorial Q&amp;A and Reporting Issues</h2>
  <p>If you need help or have questions with this tutorial, please first check HCC for existing Answers to questions on this tutorial using the Find Answers button.  If you don't find your answer you can post a new HCC question for this tutorial using the Ask Questions button.</p>
  <p><a class="btn" href="https://community.hortonworks.com/topics/tutorial-230.html" role="button">Find Answers</a> <a class="btn pull-right" href="https://community.hortonworks.com/questions/ask.html?space=81&topics=tutorial-230&topics=hdp-2.4.0" role="button">Ask Questions</a></p>
  <p>Tutorial Name: <strong>How to Load Data into the Hortonworks Sandbox</strong></p>
  <p>HCC Tutorial Tag:<strong> tutorial-230</strong> and <strong>hdp-2.4.0</strong></p>
  <p>If the tutorial has multiple labs please indicate which lab your question corresponds to. Please provide any feedback related to that lab.</p>
  <p>All Hortonworks, partner and community tutorials are posted in the Hortonworks github and can be contributed via the <a href="https://github.com/hortonworks/tutorials/wiki">Hortonworks Tutorial Contribution Guide</a>.  If you are certain there is an issue or bug with the tutorial, please <a href="https://github.com/hortonworks/tutorials/wiki#issues-with-tutorials">create an issue</a> on the repository and we will do our best to resolve it!</p>
</div>
